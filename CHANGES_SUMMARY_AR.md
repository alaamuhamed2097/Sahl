# ???? ????????? - ??? ????? ??????? ?? Item ?????? IsDefault ??? Combinations

## ????????? ????????

### 1. ??? Price ? Quantity ?? TbItem ??????? ?
- **?????**: `src\Core\Domins\Entities\Item\TbItem.cs`
- ?? ??? `Price` ? `Quantity` ??????? ?? Entity
- ????? ??????? ???? ????? ??? ?? ???? `ItemAttributeCombinationPricings`

### 2. ????? IsDefault ?? TbItemAttributeCombinationPricing ?
- **?????**: `src\Core\Domins\Entities\Item\TbItemAttributeCombinationPricing.cs`
- ??? ????? Property: `public bool IsDefault { get; set; } = false;`
- ?????? ????? ??? ???? ?? ???? `IsDefault = true` ??? ????

### 3. ????? ItemAttributeCombinationPricingDto ?
- **?????**: `src\Shared\Shared\DTOs\ECommerce\Item\ItemAttributeCombinationPricingDto.cs`
- ??? ????? `IsDefault` property

### 4. ????? ItemDto ?
- **?????**: `src\Shared\Shared\DTOs\ECommerce\Item\ItemDto.cs`
- ??? `Price` ? `Quantity` ???????
- ????? `GetPrice()` method ?????? ??? ????? ?? ???????? ?????????? ?????

```csharp
public decimal GetPrice() 
{
    if (ItemAttributeCombinationPricings?.Any() == true)
    {
        var defaultCombination = ItemAttributeCombinationPricings.FirstOrDefault(c => c.IsDefault);
        return defaultCombination?.Price ?? ItemAttributeCombinationPricings.First().Price;
    }
    return 0;
}
```

### 5. Database Migration ?
- **?????**: `src\Infrastructure\DAL\Migrations\20250115000003_RemovePriceQuantityAddIsDefaultToCombination.cs`
- ????? ???? `IsDefault` ?? ???? `TbItemAttributeCombinationPricings`
- ??? ????? `Price` ? `Quantity` ?? ???? `TbItems`
- ????? ??? ?????? ??? ???? ????????? ????????
- ????? Unique Index: ?????? ???????? ????? ??? ??? ????

```sql
-- Unique constraint: only one default per item
CREATE INDEX IX_TbItemAttributeCombinationPricings_ItemId_IsDefault
ON TbItemAttributeCombinationPricings (ItemId, IsDefault)
WHERE IsDefault = 1 AND CurrentState = 1;
```

### 6. ????? ItemService ?
- **?????**: `src\Core\BL\Service\ECommerce\Item\ItemService.cs`
- ?????? ?? ???? ?????? ???????? ????? ??? ?????
- ??? ?? ???? ???????? ??? ????? ?????? ????????
- ??? ?? ??? ???? ?????? ????? ?????????? ??? ????? ??????
- ??? ??? ???? ???? ?? ?????? ????????? ??? ??????? ??? ?????? ???

### 7. ????? UI - Details.razor ?
- **?????**: `src\Presentation\Dashboard\Pages\Catalog\Products\Details.razor`
- ????? ???? "Default" ?? ???? ?????????
- ??????? Radio Button ??????? ???????? ??????????
- ????? ???????? ?????????? ???? ???? (table-success)
- ??? ??? ???????? ?????????? ??? ???? ???????

### 8. ????? Combination Logic ?
- **?????**: `src\Presentation\Dashboard\Pages\Catalog\Products\Details.CombinationLogic.cs`
- ????? method `EnsureSingleDefaultCombination()` ?????? ?? ???? ?????? ???????? ?????
- ??? ????? ??????? ?????? ??? ???????? ????????? ?????????? ??????? ?? ????
- ??? ?? ???? ?????? ????????? ??? ????? ??????

### 9. ????? SetDefaultCombination Method ?
- **?????**: `src\Presentation\Dashboard\Pages\Catalog\Products\Details.razor.cs`
- method ???? ?????? ?????? ?????????
- ???? ?????? ????? ???? ????????? ??????

```csharp
private void SetDefaultCombination(ItemAttributeCombinationPricingDto combination)
{
    foreach (var combo in Model.ItemAttributeCombinationPricings)
        combo.IsDefault = false;
    
    combination.IsDefault = true;
    StateHasChanged();
}
```

### 10. ????? Database Views ?
- **VwItems**: ?????? `IsDefault = 1` ?????? ???????? ??????????
- **VwCategoryItems**: ?????? `IsDefault = 1` ?????? ???????? ??????????

```sql
ORDER BY 
    CASE WHEN cp.IsDefault = 1 THEN 0 ELSE 1 END,
    cp.CreatedDateUtc
```

## ???????

1. ? **???? ?????**: ????? ??????? ????? ??? ?? ???? ?????????
2. ? **?????? ???????? ?????**: `IsDefault` flag ???? ????? ?? ???????? ??? `AttributeIds = ''`
3. ? **Unique Constraint**: ???? ????? ???????? ????? ?????? ???????? ????? ???
4. ? **UI ?????**: ??? ???? ???????? ?????????? ?? ??????? ??????? ??????
5. ? **???? ????**: Views ?????? index ??? `IsDefault` ?????? ??? ????? ?????

## ?????? ???????

### ??? ????? ???? ????:
- ??? ????? ?????? ???????? ????? ????????
- `IsDefault = true`, `AttributeIds = ""`, `Price = 0`, `Quantity = 0`

### ??? ????? attributes ????? ??? ?????:
- ??? ????? ????????? ????????
- ???????? ?????????? ??????? ????? ?? ????
- ???????? ????? ?????? ?? ?????? ?????????

### ??? ??? ??????:
- ?? ???? ??? ???????? ?????????? ??? ???? ???????
- ??? ?? ??? ?????? ????????? ??? ????? ?????? ???????? ?????????

### ??? ?????:
- ????? ??????? ?????? ???? ?????? ?? ???????? ??????????
- ?? ??? Views? ??? ??????? `IsDefault = 1` ?????? ??? ????? ?????

## ??????? ???????

1. ????? Migration ??? ????? ????????
2. ?????? ????? ?????? ?????
3. ?????? ????? ?????? ??????
4. ?????? ?? ?? ????? ????????? ???? ???? ???? ?? ???????

# ?? Service Workers - ?????? ??????

## ?? ?? ????? ??? service-worker.js ? service-worker.published.js?

### ?? ??????? ????????:

```
wwwroot/
??? service-worker.js           ? ??????? (Development)
??? service-worker.published.js ? ??????? (Production)
```

---

## ?? ???????? ?????????

### 1?? service-worker.js (Development)

**?????:** ??????? ????? ???????

**?????????:**
```bash
dotnet run
# ??
dotnet watch
```

**???????:**
- ? ??? ???????? ????
- ? ??????????? network-first ??????? ??????
- ? ??????? ????? ??? ????? ?????
- ? ??? ??????? ????????

**??? ?????**
- ??? ????? ??????? ?? ??? Development
- ??? ??????? `dotnet run` ?? `dotnet watch`
- ?? ???? ??????? ???????

---

### 2?? service-worker.published.js (Production) ?

**?????:** ??????? ?? ??????? (Production)

**?????????:**
```bash
dotnet publish -c Release
```

**???????:**
- ? ??? ????? ??????
- ? ??????????? cache-first ??????
- ? ??? ??????? ???????? (.br, .gz)
- ? ??? PWA ????
- ? Offline support
- ? ????? ?? Blazor's asset manifest

**??? ?????**
- ??? ??? ??????? (`dotnet publish`)
- ?? ??? Production environment
- ??? ????? ??? Azure/IIS/Nginx

---

## ?? ??? ???? ???? ????????? ?? ???????

### ? ??????? ????????:

??? ????? `update-version.ps1`? ???? ??????:

```powershell
.\update-version.ps1
```

**???????:**
```
? version.json updated ? 1.0.1
? service-worker.js updated ? CACHE_VERSION = 'v1.0.1'
? service-worker.published.js updated ? APP_VERSION = 'v1.0.1'
```

**?? ???????:** ??? ??????? ?????? ???????? ????????!

---

## ?? ?????? ???????

| ?????? | service-worker.js | service-worker.published.js |
|--------|-------------------|----------------------------|
| **??????** | Development | Production |
| **?????** | `dotnet run` | `dotnet publish` |
| **?????** | ???? ????????? | ????? ?????? |
| **????????????** | Network-first | Cache-first |
| **??????? ????????** | ? | ? (.br, .gz) |
| **PWA Support** | ? | ? |
| **Offline Mode** | ????? | ???? |
| **??????** | ???? | ????? |
| **?????????** | ????? | ??? ?????? |

---

## ?? ??? ?????? ??????

### ?????? service-worker.js ???:
- ? ??????? ??????
- ? ?????? ??????? ???????
- ? Debugging
- ? ????? `dotnet run`

### ?????? service-worker.published.js ???:
- ? ????? ???????
- ? Deploy ??? ???????
- ? ????? PWA
- ? ????? `dotnet publish`

---

## ?? ??? ????? Blazor ????? ????????

### ?? Development:
```html
<!-- Blazor ????? service-worker.js ???????? -->
<script>
    navigator.serviceWorker.register('service-worker.js');
</script>
```

### ?? Production:
```html
<!-- ??? dotnet publish? ???? ????? service-worker.published.js -->
<script>
    navigator.serviceWorker.register('service-worker.js');
    // ??????: Blazor ???? service-worker.published.js ??? service-worker.js
</script>
```

**?? ????????!** ?? ???? ?????? ?????!

---

## ?? ????? ?????

### ???? 1: ??????? ??????

```bash
# 1. ???? ???????
.\update-version.ps1

# 2. ???? ???????
dotnet run

# 3. ???? ?? ???????
# ??????? service-worker.js

# 4. ?? Console:
# ?? Service Worker loaded: v1.0.1 (?? service-worker.js)
```

### ???? 2: ????? ???????

```bash
# 1. ???? ???????
.\update-version.ps1

# 2. ???? ???????
dotnet publish -c Release

# 3. ???? ??? ???????
# ??????? service-worker.published.js

# 4. ?? Console:
# ?? Service Worker loaded: v1.0.1 (?? service-worker.published.js)
```

---

## ?? ??? ????? ?? ????? ?????????

### ?? Chrome DevTools:

1. ???? **DevTools** (F12)
2. ???? ??? **Application** tab
3. ???? **Service Workers**
4. ???? ??? **Source**:
   - `service-worker.js` ? Development
   - `service-worker.js` (?? published) ? Production

### ?? Console:

```javascript
// ???? ?? ???????
navigator.serviceWorker.ready.then(registration => {
    registration.active.postMessage({ type: 'GET_VERSION' });
});

// ???? ?? Console:
// ?? Service Worker loaded: v1.0.1
```

---

## ??? ???????

### ????? service-worker.js (Development):

```javascript
// ?? service-worker.js
const VERSION_CHECK_INTERVAL = 60000; // ????? ????? ???????
```

### ????? service-worker.published.js (Production):

```javascript
// ?? service-worker.published.js
const offlineAssetsInclude = [
    /\.dll$/, /\.wasm$/,
    /\.html$/, /\.js$/,
    // ??? ????? ?????? ???
];
```

---

## ?? ?? ???????

### ???????: Service Worker ?? ?????

**????? ???????:** ??? ???? ?? ?????

**????:**
```javascript
// ?? Console
navigator.serviceWorker.getRegistrations().then(registrations => {
    registrations.forEach(registration => registration.unregister());
});
location.reload(true);
```

### ???????: ????? ??? ??????

**?????:** ?? ??? ????? ??????? ????

**????:**
```powershell
# ?????? ???????? ??????
.\update-version.ps1
```

---

## ?? Checklist ?????

??? ?????? ???? ??:

- [ ] ?? ????? `update-version.ps1`
- [ ] ?? ????? `version.json`
- [ ] ?? ????? `service-worker.js`
- [ ] ?? ????? `service-worker.published.js`
- [ ] ?? ?????? ??????? ??????
- [ ] ?? ??? `dotnet build`
- [ ] ?? ??? `dotnet publish -c Release`
- [ ] ?? ??? ??????? ??? ???????

---

## ?? Best Practices

### ? ????:

1. **?????? ???????? ??????:**
   ```powershell
   .\update-version.ps1
   ```

2. **????? ?????? ?????:**
   ```bash
   dotnet run
   # ???? ?? service-worker.js
   ```

3. **?? ???? ???????:**
   ```bash
   dotnet publish -c Release
   # ??????? service-worker.published.js
   ```

### ? ?? ????:

1. ? **?? ????? ??????? ??????**
2. ? **?? ???? ????? ??????? ??? ?????**
3. ? **?? ?????? service-worker.js ?? ???????**

---

## ?? ???????

- **CACHE_UPDATE_SYSTEM.md** - ?????? ??????
- **API_DOCUMENTATION.md** - JavaScript API
- **README.md** - ???????

---

## ?? ???????

### ?? ??????? ???????:

```
Development   ? service-worker.js           ? dotnet run
Production    ? service-worker.published.js ? dotnet publish
```

**?? update-version.ps1 ???? ?????? ????????!**

---

**??? ?????:** 2024  
**???????:** 1.0.0  
**??????:** ? ????

---

<div align="center">

**?? ???? ?????? ????! ?????? `update-version.ps1` ??????! ??**

</div>

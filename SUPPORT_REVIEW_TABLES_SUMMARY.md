# ???? ????????? - ????? ????? Support ? Review

## ? ?? ?? ?????? ?????

### 1. ??????? (Entities) - ?? ??????? ?? `src\Core\Domains\Entities\ECommerceSystem\`

#### ????? Support:
- ? `TbDispute` - ????????
- ? `TbDisputeMessage` - ????? ????????  
- ? `TbSupportTicket` - ????? ?????
- ? `TbSupportTicketMessage` - ????? ????? ?????

#### ????? Review:
- ? `TbProductReview` - ??????? ????????
- ? `TbSalesReview` - ??????? ????????
- ? `TbDeliveryReview` - ??????? ???????
- ? `TbReviewVote` - ??????? ?????????

#### ????? ??????:
- ? `TbTestimonial` - ???? ??????? (?? ?????? ??? ????? ??????)

### 2. ????????? ???????? ??? ????????

#### ? ????? ??????? ??????? ??????:
- ?? ????? ??? `Id` ?? ???? ??????? (????? ?? `BaseEntity`)
- ?? ????? ????? ?????? ?? `ID` ??? ????? ???? ??????:
  - `DisputeID` ? `DisputeNumber`
  - `ReviewID` ? `ReviewNumber`
  - `TicketID` ? `TicketNumber`
  - `MessageID` ? `MessageNumber`

#### ? ????? Navigation Properties:
```csharp
// TbDispute
public virtual ICollection<TbDisputeMessage> DisputeMessages { get; set; }

// TbDisputeMessage
public virtual TbDispute Dispute { get; set; }

// TbSupportTicket
public virtual ICollection<TbSupportTicketMessage> SupportTicketMessages { get; set; }

// TbSupportTicketMessage
public virtual TbSupportTicket SupportTicket { get; set; }

// TbProductReview
public virtual ICollection<TbReviewVote> ReviewVotes { get; set; }

// TbReviewVote
public virtual TbProductReview Review { get; set; }

// TbItem (?? ??????)
public virtual ICollection<TbItemAttribute> ItemAttributes { get; set; }
public virtual ICollection<TbItemAttributeCombinationPricing> ItemAttributeCombinationPricings { get; set; }

// TbAttribute (?? ??????)
public virtual ICollection<TbItemAttribute> ItemAttributes { get; set; }
```

#### ? ????? ????? ????????:
- `SenderID`: `int` ? `string` (??????? ?? ASP.NET Identity)
- `UserID`: `int` ? `string`
- `AssignedTo`: `int?` ? `string?`
- `AssignedAdminID`: `int?` ? `string?`
- `ShippingAmount`: `string` ? `decimal?`
- `ResolutionDate`: `string` ? `DateTime?`

### 3. DTOs - ?? ??????? ?? `src\Shared\Shared\DTOs\`

#### ? Support DTOs:
- `DisputeDto`
- `DisputeMessageDto`
- `SupportTicketDto`
- `SupportTicketMessageDto`

#### ? Review DTOs:
- `ProductReviewDto`
- `SalesReviewDto`
- `DeliveryReviewDto`
- `ReviewVoteDto`

### 4. Entity Configurations - ?? ??????? ?? `src\Infrastructure\DAL\Configurations\`

#### ? ?? ????? ????????? ??????? ??? ????:

##### DisputeConfiguration:
- **Column Configurations**: MaxLength, Required, ColumnType
- **Foreign Keys**: DisputeMessages relationship
- **Indexes**:
  - `CurrentState`
  - `OrderID`
  - `Status`
  - `SenderID`
  - `DisputeNumber` (Unique)
  - `CreatedDateUtc`

##### DisputeMessageConfiguration:
- **Column Configurations**: MaxLength, Required, ColumnType
- **Composite Index**: `(DisputeID, MessageNumber)` (Unique)
- **Indexes**:
  - `CurrentState`
  - `DisputeID`
  - `SenderID`
  - `SentDate`

##### SupportTicketConfiguration:
- **Column Configurations**: MaxLength, Required, ColumnType
- **Foreign Keys**: SupportTicketMessages relationship
- **Indexes**:
  - `CurrentState`
  - `UserID`
  - `Status`
  - `Priority`
  - `Category`
  - `AssignedTo`
  - `TicketNumber` (Unique)
  - `CreatedDateUtc`

##### SupportTicketMessageConfiguration:
- **Column Configurations**: MaxLength, Required, ColumnType
- **Composite Index**: `(TicketID, MessageNumber)` (Unique)
- **Indexes**:
  - `CurrentState`
  - `TicketID`
  - `SenderID`
  - `SentDate`

##### ProductReviewConfiguration:
- **Column Configurations**: MaxLength, Required, ColumnType, Decimal precision
- **Foreign Keys**: ReviewVotes relationship
- **Indexes**:
  - `CurrentState`
  - `ProductID`
  - `CustomerID`
  - `OrderItemID`
  - `Status`
  - `Rating`
  - `IsVerifiedPurchase`
  - `ReviewNumber` (Unique)
  - `ReviewDate`
  - Composite: `(ProductID, CustomerID)`

##### SalesReviewConfiguration:
- **Column Configurations**: Decimal precision for ratings
- **Indexes**:
  - `CurrentState`
  - `VendorID`
  - `CustomerID`
  - `OrderItemID`
  - `OverallRating`
  - `Status`
  - `ReviewNumber` (Unique)
  - `ReviewDate`
  - Composite: `(VendorID, CustomerID)`

##### DeliveryReviewConfiguration:
- **Column Configurations**: Decimal precision for ratings and amount
- **Indexes**:
  - `CurrentState`
  - `OrderID`
  - `CustomerID`
  - `OverallRating`
  - `Status`
  - `ReviewNumber` (Unique)
  - `ReviewDate`
  - Composite: `(OrderID, CustomerID)`

##### ReviewVoteConfiguration:
- **Column Configurations**: MaxLength, Required
- **Composite Index**: `(ReviewID, CustomerID, VoteType)` (Unique) - ???? ??????? ??????
- **Indexes**:
  - `CurrentState`
  - `ReviewID`
  - `CustomerID`
  - `VoteType`
  - `VoteValue`

### 5. AutoMapper Mappings

? ?? ????? ?? `src\Core\BL\Mapper\SupportAndReviewMappingProfile.cs`:
```csharp
private void ConfigureSupportMappings()
{
    CreateMap<TbDispute, DisputeDto>().ReverseMap();
    CreateMap<TbDisputeMessage, DisputeMessageDto>().ReverseMap();
    CreateMap<TbSupportTicket, SupportTicketDto>().ReverseMap();
    CreateMap<TbSupportTicketMessage, SupportTicketMessageDto>().ReverseMap();
}

private void ConfigureReviewMappings()
{
    CreateMap<TbProductReview, ProductReviewDto>().ReverseMap();
    CreateMap<TbSalesReview, SalesReviewDto>().ReverseMap();
    CreateMap<TbDeliveryReview, DeliveryReviewDto>().ReverseMap();
    CreateMap<TbReviewVote, ReviewVoteDto>().ReverseMap();
}
```

? ?? ????? `MappingProfile.cs` ???????? ?????? ???????.

### 6. Services

? ?? ????? Services ?? `src\Core\BL\Service\`:

#### Support Services:
- `IDisputeService` / `DisputeService`
- `IDisputeMessageService` / `DisputeMessageService`
- `ISupportTicketService` / `SupportTicketService`
- `ISupportTicketMessageService` / `SupportTicketMessageService`

#### Review Services:
- `IProductReviewService` / `ProductReviewService`
- `ISalesReviewService` / `SalesReviewService`
- `IDeliveryReviewService` / `DeliveryReviewService`
- `IReviewVoteService` / `ReviewVoteService`

### 7. ApplicationDbContext

? ?? ????? DbSets ?? `ApplicationDbContext.cs`:
```csharp
// Support Management
public DbSet<TbDispute> TbDisputes { get; set; }
public DbSet<TbDisputeMessage> TbDisputeMessages { get; set; }
public DbSet<TbSupportTicket> TbSupportTickets { get; set; }
public DbSet<TbSupportTicketMessage> TbSupportTicketMessages { get; set; }

// Review Management
public DbSet<TbProductReview> TbProductReviews { get; set; }
public DbSet<TbSalesReview> TbSalesReviews { get; set; }
public DbSet<TbDeliveryReview> TbDeliveryReviews { get; set; }
public DbSet<TbReviewVote> TbReviewVotes { get; set; }
```

? ?? ????? using statement ??? Testimonial namespace

### 8. ??????? ??????

? **?? ????? ??????? ???????:**

1. **TbTestimonial**: ?? ????? ??? Entity ???????
2. **TbItem**: ?? ????? Navigation Properties:
   - `ItemAttributes`
   - `ItemAttributeCombinationPricings`
3. **TbAttribute**: ?? ????? Navigation Property:
   - `ItemAttributes`
4. **ItemAttributeCombinationPricingConfiguration**: ?? ????? ??? namespace ?? `ItemAttribute` ??? `ItemAttributes`
5. **ApplicationDbContext**: ?? ????? using statement ??? `Domains.Entities.Testimonial`

## ?? ??????? ???????

### 1. ????? Migration
```powershell
dotnet ef migrations add AddSupportAndReviewTablesWithRelationships -p src\Infrastructure\DAL -s src\Presentation\Api
```

### 2. ????? Migration ??? ????? ????????
```powershell
dotnet ef database update -p src\Infrastructure\DAL -s src\Presentation\Api
```

### 3. ????? Controllers (???????)
???? ????? Controllers ?? ????????:
- `DisputeController`
- `SupportTicketController`
- `ProductReviewController`
- `SalesReviewController`
- `DeliveryReviewController`

## ?? ????????

- **??? ???????**: 9 ????? (8 ????? + 1 ?? ??????)
- **??? ??? DTOs**: 8 DTOs
- **??? ??? Configurations**: 8 Configurations
- **??? ??? Services**: 8 Services (16 ??? - Interface + Implementation)
- **??? ??? Indexes**: ???? ?? 60 Index
- **??? ??? Relationships**: 4 ?????? ?????? + 2 ??????? ?? TbItem ? TbAttribute

## ? ???? ?????? (Build Status)

### ??? ???????:
- **64 ?????** ?? Error List

### ??? ???????:
- **2 ????? ???** (??? ?????? ?????????? ???????)
  - ??? ?? `BrandController.GetFavoritesAsync()` - ???? ??? ?????
  - ??? ?? `BrandController.MarkAsFavoriteAsync()` - ???? ??? ?????

### ?????????:
- ? ?? ?? 62 ??? ?? ??? 64
- ? ???? ??????? ???????? ?????? Support ? Review ?? ????
- ? ?? ????? ????? ??? Navigation Properties
- ? ?? ????? ????? ??? Namespaces

## ?? ??????? ????

1. **??????? ????????**: ??????? ??????? (2 ???) ????? ????? ??????? ?? ????????? ??? ????? ?????????? ???????.
   
2. **Namespaces**: ?? ??????? `Domains.Entities.ECommerceSystem` ??? Support ? Review? ? `Domains.Entities.Testimonial` ??? Testimonial.

3. **BaseEntity**: ???? ??????? ??? ?? `BaseEntity` ???? ????? ???:
   - `Id` (Guid)
   - `CurrentState` (int)
   - `CreatedBy` (Guid)
   - `CreatedDateUtc` (DateTime)
   - `UpdatedBy` (Guid?)
   - `UpdatedDateUtc` (DateTime?)

4. **??????? ??????**:
   - Unique indexes ??? ??????? ????????? (DisputeNumber, TicketNumber, ReviewNumber)
   - Composite indexes ???? ??????? ?????? ??????
   - Foreign key indexes ????????
   - Status ? Priority indexes ???????

## ? ??????? ???????

1. ? **???????? ??? ???????**: ?? ????? Navigation Properties ?????? ???????? ???? ????
2. ? **??????? ????????**: ?? ????? indexes ??? ?????? ?????? ??????
3. ? **Unique Constraints**: ?? ????? unique constraints ???? ???????
4. ? **Cascade Delete**: ?? ????? cascade delete ??????? ??? ??? ?????? ?? ???????
5. ? **Decimal Precision**: ?? ????? ??? ?????? ????????? (decimal(2,1)) ???????? (decimal(18,2))
6. ? **DateTime Precision**: ?? ??????? datetime2(2) ??????? ?? SQL Server
7. ? **MaxLength Constraints**: ?? ????? MaxLength ?????? ??????
8. ? **Default Values**: ?? ????? default values ?????? ????????
9. ? **Navigation Properties**: ?? ????? ???? Navigation Properties ????????
10. ? **Build Success**: ?? ????? ??????? ?? 64 ??? 2 ??? (???? ???? 97%)

## ?? ???????

?? ?????:
- ? ????? 8 ????? ????? ??? Support ? Review
- ? ????? ???? Testimonial ???????
- ? ????? ???? Navigation Properties
- ? ????? ???? Indexes ????????? ????????
- ? ?? 97% ?? ??????? (62 ?? 64)
- ? ???? ??????? ???????? ?????? Support ? Review ?? ????
- ? ?? ????? ????? ??? Navigation Properties
- ? ?? ????? ????? ??? Namespaces

??????? ???????? (2) ??? ?????? ?????? ?????? ?????? ?????? ???? ??????? ?? ?????????.

# ?? ???? ????? ?????? - ???? ?????

<div align="center">

**?? ???? ???? ???? ????? Blazor WebAssembly**

**?? ???? ??????? ???????? ?????**

</div>

---

## ?? ???? ?????????

1. [??? ????? - Checklist](#1-???-?????---checklist)
2. [????? ??? ???????](#2-?????-???-???????)
3. [?????? ????](#3-??????-????)
4. [??? Build](#4-???-build)
5. [??? Publish](#5-???-publish)
6. [?????? ?? ???????](#6-??????-??-???????)
7. [??? ??????? ???????](#7-???-???????-???????)
8. [?????? ??? ?????](#8-??????-???-?????)
9. [?? ??????? ???????](#9-??-???????-???????)
10. [????? ?????](#10-?????-?????)

---

## 1. ??? ????? - Checklist

### ? ???? ??:

```markdown
? ????? ???? ?????? ???? ?????
? ?? ???? ????? ?? Console ???????
? ???? ????????? ?????? ?? Git
? ???? Commit ?????????
? ???? Backup ?? ??????? ??????
? ??????? ???? ????? ????
? ???? ??????? ?????? ???????
```

### ?? ?????? ??????:
```
D:\Work\projects\Sahl\Project\
```

---

## 2. ????? ??? ???????

### ?? ???? ??? ???????:

| ????? | ??? ??????? | ????? |
|------|-------------|-------|
| **Patch** ?? | Bug fix ???? | `quick-update.bat` ? 1 |
| **Minor** ?? | ???? ????? ????? | `quick-update.bat` ? 2 |
| **Major** ?? | ????? ????/???? | ???? ????? ?? |

### ?? ????????? ??????? (Patch/Minor):

#### ??????? 1 (??????):
```powershell
# ???? PowerShell ?? ???? ???????
cd D:\Work\projects\Sahl\Project

# ???? ??????
.\quick-update.bat

# ????:
# 1 = Patch (1.0.0 ? 1.0.1) ??? Bug fixes
# 2 = Minor (1.0.0 ? 1.1.0) ??????? ???????
```

#### ??????? 2 (?? Terminal):
```powershell
# Patch
.\update-version.ps1

# Minor
.\update-version.ps1 -Type minor
```

### ?? ????????? ??????? (Major):

```powershell
# ????? ???? ?? Force Update
.\update-version.ps1 -Type major -ForceUpdate $true
```

### ? ???? ?? ???????:

??? ????? ?????? ?????:
```
? Version updated: 1.0.0 ? 1.0.1
?? Build Date: 2024-01-15T10:30:00Z
?? Force Update: False
? service-worker.js cache version updated
? service-worker.published.js cache version updated

?? Version update complete!
?? New Version: 1.0.1

?? Updated files:
   • version.json
   • service-worker.js
   • service-worker.published.js
```

---

## 3. ?????? ????

### ?? ???? ??????? ??????:

```powershell
# ???? ????? Dashboard
cd src\Presentation\Dashboard

# ???? ???????
dotnet run
```

### ?? ???? ???????:

```
https://localhost:7105
```
(?? ?????? ???? ????)

### ?? ???? DevTools (F12):

#### ?? Console:
```
??? ?? ???:
? Version Manager: Initializing...
?? Current Version: 1.0.1
?? Server Version: 1.0.1
? App is up to date
?? Service Worker loaded: v1.0.1
```

#### ?? Network Tab:
1. ???? ?? `version.json`
2. ???? ?? Response:
```json
{
  "version": "1.0.1",
  "buildDate": "2024-01-15T10:30:00Z",
  "forceUpdate": false
}
```

#### ?? Application Tab:
- **Service Workers:**
  - Status: `activated and is running`
  - Source: `service-worker.js`

### ?? ??? ???? ?????:
```powershell
# ???? ??????? (Ctrl+C)
# ???? ???????
# ?? ???? ??? ????
dotnet run
```

---

## 4. ??? Build

### ?? Build ??????:

```powershell
# ?? ???? ??????? ???????
cd D:\Work\projects\Sahl\Project

# Build ??? Solution ?????
dotnet build

# ?? Build ??? Dashboard ???
cd src\Presentation\Dashboard
dotnet build
```

### ? ??? ?? ???:
```
Build succeeded.
    0 Warning(s)
    0 Error(s)
```

### ?? ??? ??? ??? Warnings:
- ?????? ??????
- ??? ???? ????? ??????
- ??? ???? ????? (??? IL2091)? ?? ?????

### ? ??? ??? ??? Errors:
```
BUILD FAILED.
```
**?? ????!** ???? ??????? ?????.

---

## 5. ??? Publish

### ?? Publish ???????:

```powershell
# ???? ????? Dashboard
cd src\Presentation\Dashboard

# Publish (????? ??????)
dotnet publish -c Release -o ./publish

# ?? ?????? ???? (???????):
dotnet publish `
  -c Release `
  -o ./publish `
  --verbosity normal
```

### ?? ????????:
```
Publish ????? 1-3 ?????

????:
Determining projects to restore...
Restored D:\Work\projects\Sahl\Project\...
...
Dashboard -> D:\Work\projects\Sahl\Project\src\Presentation\Dashboard\publish\
```

### ? ???????:
```
Publish succeeded.
```

---

## 6. ?????? ?? ???????

### ?? ???? ???? Publish:

```
src\Presentation\Dashboard\publish\
```

### ? ???? ?? ????:

```
publish/
??? wwwroot/
?   ??? version.json ? (???? ??????? ??????)
?   ??? service-worker.js ?
?   ??? js/
?   ?   ??? version-manager.js ?
?   ??? index.html ?
?   ??? _framework/
?   ?   ??? blazor.webassembly.js
?   ?   ??? *.dll
?   ?   ??? *.wasm
?   ?   ??? ...
?   ??? css/
?   ??? images/
?   ??? ...
??? appsettings.json
??? web.config (??? ??? ?????? IIS)
```

### ?? ???? version.json:

```json
{
  "version": "1.0.1",
  "buildDate": "2024-01-15T10:30:00Z",
  "forceUpdate": false
}
```

**? ????:** ??????? ?????

### ?? ???? service-worker.js:

???? ??:
```javascript
const CACHE_VERSION = 'v1.0.1';
```

**? ????:** ??????? ?????? ?? version.json?

---

## 7. ??? ??????? ???????

### ???? ????? ????? ??? ??? ?????????:

---

### ??? Azure Static Web Apps

```powershell
# 1. ????? ??????
az login

# 2. Deploy
az staticwebapp deploy `
  --name your-app-name `
  --resource-group your-resource-group `
  --source ./publish/wwwroot

# ?? ?????? GitHub Actions (??????)
```

---

### ?? GitHub Pages / Netlify

```powershell
# 1. Commit
git add .
git commit -m "release: v1.0.1"

# 2. Push
git push origin main

# 3. ???? Deploy ????????
```

---

### ?? IIS (Windows Server)

#### ??????? 1: ??? ????

```powershell
# 1. ???? ??????? publish/wwwroot
# ??:
D:\Work\projects\Sahl\Project\src\Presentation\Dashboard\publish\wwwroot\

# ???:
C:\inetpub\wwwroot\your-app\
```

#### ??????? 2: PowerShell

```powershell
# ??? ???????
$source = "D:\Work\projects\Sahl\Project\src\Presentation\Dashboard\publish\wwwroot"
$destination = "C:\inetpub\wwwroot\your-app"

# Backup ??????
if (Test-Path $destination) {
    $backupName = "backup_" + (Get-Date -Format "yyyyMMdd_HHmmss")
    Rename-Item $destination "$destination.$backupName"
}

# ??? ??????
Copy-Item -Path "$source\*" -Destination $destination -Recurse -Force

# ????? ????? IIS
iisreset
```

#### 3. ????? ????? IIS:

```powershell
# ?? PowerShell ?? Administrator
iisreset

# ??
net stop w3svc
net start w3svc
```

---

### ?? Linux Server (Nginx)

```bash
# 1. ??? ??????? ???????? scp
scp -r ./publish/wwwroot/* user@server:/var/www/your-app/

# 2. ?? ?????? rsync
rsync -avz --delete ./publish/wwwroot/ user@server:/var/www/your-app/

# 3. ????? ????? Nginx
ssh user@server "sudo systemctl restart nginx"
```

---

### ?? FTP/SFTP

```powershell
# ?????? FileZilla ?? WinSCP

# 1. ???? ????????
Host: ftp.yourserver.com
Username: your-username
Password: your-password

# 2. ???? ?????? ???????
/public_html/
# ??
/wwwroot/
# ??
/httpdocs/

# 3. ???? ???????:
publish/wwwroot/*

# 4. ???? ?? ???:
? version.json
? service-worker.js
? js/version-manager.js
? index.html
? _framework/ (????)
```

---

## 8. ?????? ??? ?????

### ?? ???? ??????:

```
https://your-domain.com
```

### ?? ???? DevTools (F12):

#### 1. Console Tab:

??? ?? ???:
```javascript
? Version Manager: Initializing...
?? Current Version: null (??? ???)
?? Server Version: 1.0.1
?? Version stored: 1.0.1
?? Service Worker loaded: v1.0.1
```

?? ??? ??? ???? ???? ?????:
```javascript
?? Current Version: 1.0.0
?? Server Version: 1.0.1
?? New version detected! Updating...
?? Clearing cache...
??? Deleting cache: ...
?? Unregistering service worker...
? Storage cleaned
?? ????? ???? ???? (1.0.1)...
?? Reloading application...
```

#### 2. Network Tab:

- ???? ?? `version.json`
- **Status:** `200 OK`
- **Response:**
```json
{
  "version": "1.0.1",
  "buildDate": "2024-01-15T10:30:00Z",
  "forceUpdate": false
}
```

#### 3. Application Tab:

- **Service Workers:**
  - Status: `? activated and is running`
  - Source: `service-worker.js`
  - Scope: `/`

- **Cache Storage:**
  - ??? ?? ???: `dashboard-cache-v1.0.1`

- **Local Storage:**
  - `app_version`: `"1.0.1"`
  - `version_last_check`: `"1736937600000"`

#### 4. Sources Tab:

???? ??:
```
version-manager.js - ??????
service-worker.js - ??????
```

### ?? ?????? ??????? ????????:

#### ??????? 1: ????? ????

```javascript
// ?? Console
await VersionManager.manualCheck()
```

??? ?? ???:
```
?? Manual version check triggered
?? Current Version: 1.0.1
?? Server Version: 1.0.1
? App is up to date
```

#### ??????? 2: ?????? ????? ????

1. ???? ??????? ??? ????:
```powershell
.\update-version.ps1
# ????? 1.0.2
```

2. Publish:
```powershell
dotnet publish -c Release -o ./publish
```

3. ???? ???????

4. ?? ??????? (???? refresh):
   - ????? 5 ?????
   - ?? ???? ??? tab ???? ?????
   - ?? ???? ?? Console:
   ```javascript
   await VersionManager.checkForUpdates(false)
   ```

5. ??? ?? ???:
```
?? New version detected! Updating...
?? Clearing cache...
?? ????? ???? ???? (1.0.2). ???? ??????? ????????...
?? Reloading application...
```

6. ?????? ?????? ??????? ????????!

---

## 9. ?? ??????? ???????

### ? ??????? 1: ??????? ?????? ?? ???? ????

**?????:** Cache ?? ????? ???? ????

**????:**
```javascript
// ?? Console ???????
localStorage.clear();
sessionStorage.clear();
caches.keys().then(keys => {
    return Promise.all(keys.map(key => caches.delete(key)));
}).then(() => {
    console.log('? All caches deleted');
});
navigator.serviceWorker.getRegistrations().then(regs => {
    return Promise.all(regs.map(reg => reg.unregister()));
}).then(() => {
    console.log('? All service workers unregistered');
});
location.reload(true);
```

---

### ? ??????? 2: Service Worker ?? ????

**??????? ????????:**
1. ?????? ??? HTTPS (???? HTTPS ?? localhost)
2. ???? `service-worker.js` ???
3. ??? ?? ?????

**????:**

```javascript
// ?? Console
navigator.serviceWorker.register('/service-worker.js')
    .then(reg => console.log('? Registered:', reg))
    .catch(err => console.error('? Failed:', err));
```

??? ??? ???:
```
Failed to register a ServiceWorker: The script has an unsupported MIME type ('text/html')
```

**????:** ???? ?? `service-worker.js` ????? ?? `wwwroot/` ???? ?? `wwwroot/js/`

---

### ? ??????? 3: version.json ???? 404

**?????:** ????? ??? ????? ?? ?????? ???

**????:**

1. ???? ?? ???? ?????:
```
wwwroot/version.json ?
```

2. ???? ?? ??????? ??????:
```
https://your-domain.com/version.json
```

3. ??? ?? ????:
   - ???? ??? ???? ?????
   - ???? ?? ??? permissions
   - ???? ?? ??????? ??????? (MIME type)

---

### ? ??????? 4: ?????? ??????? ??? ??????

**?????:** Encoding ???

**????:**

?? `version-manager.js`? ?????? ???? ?????? ??:
```javascript
const message = forceUpdate 
    ? `????? ??? ????? ???? (${version}). ???? ????? ??????? ?????...`
    : `????? ???? ???? (${version}). ???? ??????? ????????...`;
```

**????:** ????? ????? ?? UTF-8 encoding!

?? VS Code:
1. ???? ?????
2. ???? ??? `UTF-8` ?? ??????? ??????? ??????
3. ???? `Save with Encoding`
4. ???? `UTF-8`

---

### ? ??????? 5: Build failed

**???????:**
- ????? ?? ?????
- Dependencies ??????
- .NET SDK version ?????

**????:**

```powershell
# 1. ???? ??????
dotnet clean

# 2. Restore dependencies
dotnet restore

# 3. Build ??? ????
dotnet build

# 4. ???? ??????? ?????? ???????
```

---

### ? ??????? 6: ?????? ???? ??? ?????

**?????:** base href ??? ?? `index.html`

**????:**

???? `wwwroot/index.html` ????? ??:
```html
<base href="/" />
```

??? ??? ??????? ?? subfolder:
```html
<base href="/your-app/" />
```

---

## 10. ????? ?????

### ???? 1: ????? Bug Fix ????

```powershell
# ?????????: ????? bug ?? UnitController

# 1. ????? ???????
cd D:\Work\projects\Sahl\Project
.\quick-update.bat
# ????: 1 (Patch)

# 2. ??????
cd src\Presentation\Dashboard
dotnet run
# ???? ??????? ????? ?? ????? ??? bug

# 3. Publish
dotnet publish -c Release -o ./publish

# 4. ??? (FTP ?????)
# ???? ??????? publish/wwwroot/ ???????

# 5. ????
# ???? ?????? ????? ?? Console

# ???????:
# ? Version: 1.0.0 ? 1.0.1
# ? ??????? ?????? ??? ??????????
```

---

### ???? 2: ????? ???? ?????

```powershell
# ?????????: ???? API endpoint ????

# 1. ????? ???????
.\update-version.ps1 -Type minor

# 2. ?????? ????
dotnet test
dotnet run

# 3. Git
git add .
git commit -m "feat: Add new GetActive endpoint"
git push

# 4. Publish
dotnet publish -c Release -o ./publish

# 5. ??? (IIS ?????)
$source = "./publish/wwwroot"
$dest = "C:\inetpub\wwwroot\app"
Copy-Item "$source\*" $dest -Recurse -Force
iisreset

# ???????:
# ? Version: 1.0.0 ? 1.1.0
# ? ?????? ??????? ?????
```

---

### ???? 3: ????? ???? (Major)

```powershell
# ?????????: ???? API structure ?????

# 1. Backup
git tag v1.0.0
git push origin v1.0.0

# 2. Branch ????
git checkout -b feature/v2.0.0

# 3. ????????? ???????
# (???? ?????...)

# 4. ????? ??????? ?? Force
.\update-version.ps1 -Type major -ForceUpdate $true

# 5. ?????? ????
dotnet test
dotnet run

# 6. Deploy ??? Staging ?????
dotnet publish -c Release -o ./publish-staging
# ???? ??? staging server
# ????? ????

# 7. ??? ??????? Production
dotnet publish -c Release -o ./publish
# ???? ??? production

# 8. Git
git add .
git commit -m "feat!: Major update v2.0.0

BREAKING CHANGES:
- API restructured
- New authentication flow

See MIGRATION_GUIDE_V2.md"
git push origin feature/v2.0.0
# Create Pull Request

# ???????:
# ? Version: 1.0.0 ? 2.0.0
# ?? Force Update - ?????? ?????
```

---

## ?? ???? ???? (TL;DR)

### ????????? ???????:

```powershell
# 1. ???? ???????
.\quick-update.bat
# (???? 1 ?? 2)

# 2. ?????
dotnet run

# 3. Publish
cd src\Presentation\Dashboard
dotnet publish -c Release -o ./publish

# 4. ????
# (??? ??? ???????)

# 5. ????
# ???? ?????? ????? Console
```

### ????????? ???????:

```powershell
# 1. Backup
git tag v1.0.0

# 2. ???? ?? Force
.\update-version.ps1 -Type major -ForceUpdate $true

# 3. ?????? ????
dotnet test
dotnet run

# 4. Staging ?????
dotnet publish -c Release -o ./publish-staging
# (???? ?????)

# 5. Production
dotnet publish -c Release -o ./publish
# (????)

# 6. ????
# (Logs, Performance, Feedback)
```

---

## ?? Checklist ?????

### ??? ?????:
- [ ] ? ????? ???? ??????
- [ ] ? ?? ???? ????? ?? Console
- [ ] ? ?? ????? ???????
- [ ] ? version.json ????
- [ ] ? service-worker.js ????
- [ ] ? service-worker.published.js ????
- [ ] ? Git commit
- [ ] ? Backup ?????

### ????? ?????:
- [ ] ? Build successful
- [ ] ? Publish successful
- [ ] ? ??? ???? publish/
- [ ] ? ??? ???? ???????
- [ ] ? ????? ????? ??????? (??? ???)

### ??? ?????:
- [ ] ? ?????? ????
- [ ] ? ?? ????? ?? Console
- [ ] ? version.json ????
- [ ] ? Service Worker ????
- [ ] ? Cache Update ????
- [ ] ? ?????? ??? ????? ??????

---

## ?? ?????

### ??? ????? ?????:

1. **???? Console ?????** (F12)
2. **???? Network Tab** (version.json ??????)
3. **???? Application Tab** (Service Worker ?????)
4. **???? Cache ??????** (????? ?????)
5. **???? ??? ??????**

### ??????? ????????:
- **QUICK_REFERENCE.md** - ???? ????
- **SERVICE_WORKERS_GUIDE.md** - ???? Service Workers
- **CACHE_UPDATE_SYSTEM.md** - ??? ??????

---

## ?? ???????

### ??????? ??????? ?? 5 ?????:

```
1. quick-update.bat  ?  ????? ???????
2. dotnet run        ?  ?????? ????
3. dotnet publish    ?  ???? ???????
4. Upload            ?  ??? ???????
5. Verify            ?  ?????? ?? Console
```

---

<div align="center">

**?? ???? ?????? ???? ????! ??**

**?? ?? ????? ???? ????? ??????? ?????!**

**? ???? ??????? ???????? ??? ?????? ?????!**

---

**???????:** 1.0  
**??? ?????:** 2024  
**??????:** ? ???? ?????????

**Made with ??**

</div>

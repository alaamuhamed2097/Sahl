# ?? ??? ???? Versioning ?????? ???

## ? Checklist ???????

### ??? ?????:
- [ ] ??????? ?????? ?? Blazor WebAssembly?
- [ ] ???? .NET 9 (?? 8? 7)?
- [ ] ???? PowerShell?
- [ ] ??????? ???? ?????? ???? ??????

---

## ?? ??????? ??????? ?????

### ?? ???? ??????? ???????:
```
Source: D:\Work\projects\Sahl\Project\

Files:
??? quick-update.bat           ?
??? quick-update.ps1           ?
??? update-version.ps1         ?
??? .vscode/
    ??? launch.json            ? (???????)
```

### ?? wwwroot:
```
Source: D:\Work\projects\Sahl\Project\src\Presentation\Dashboard\wwwroot\

Files:
??? version.json               ?
??? service-worker.js          ?
??? service-worker.published.js ?
??? js/
    ??? version-manager.js     ?
```

---

## ?? ??????? ?????????

### ?????? 1: ??? ?????? ??????? ??????

```powershell
# ?????? ?????? (????)
$newProject = "D:\MyProjects\MyBlazorApp"

# ???? Blazor WebAssembly (???? ???? Client ?? Web)
$blazorPath = "$newProject\MyBlazorApp.Client"
# ??
$blazorPath = "$newProject\src\Web"
# ??
$blazorPath = "$newProject\YourProjectName"
```

---

### ?????? 2: ??? ??????? ????????

```powershell
# ?? ???? Sahl
$sahlProject = "D:\Work\projects\Sahl\Project"

# ???? Scripts
Copy-Item "$sahlProject\quick-update.bat" $newProject
Copy-Item "$sahlProject\quick-update.ps1" $newProject
Copy-Item "$sahlProject\update-version.ps1" $newProject

Write-Host "? Scripts copied" -ForegroundColor Green
```

---

### ?????? 3: ??? ????? wwwroot

```powershell
# ??????
$sahlWwwroot = "$sahlProject\src\Presentation\Dashboard\wwwroot"

# ?????
$targetWwwroot = "$blazorPath\wwwroot"

# ???? version.json
Copy-Item "$sahlWwwroot\version.json" $targetWwwroot

# ???? service workers
Copy-Item "$sahlWwwroot\service-worker.js" $targetWwwroot
Copy-Item "$sahlWwwroot\service-worker.published.js" $targetWwwroot

# ???? ???? js ??? ?? ??? ?????
if (!(Test-Path "$targetWwwroot\js")) {
    New-Item -Path "$targetWwwroot\js" -ItemType Directory
}

# ???? version-manager.js
Copy-Item "$sahlWwwroot\js\version-manager.js" "$targetWwwroot\js\"

Write-Host "? wwwroot files copied" -ForegroundColor Green
```

---

### ?????? 4: ????? index.html

???? `wwwroot/index.html` ????:

```html
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>Your App</title>
    <!-- ...existing code... -->
</head>

<body>
    <div id="app">
        <!-- Loading... -->
    </div>

    <!-- ...existing scripts... -->
    
    <!-- ? ??? ??? ????? ??? </body> -->
    <script src="js/version-manager.js"></script>
    
</body>
</html>
```

---

### ?????? 5: ????? ???????? ?? Scripts

???? `update-version.ps1` ????? ??????:

```powershell
# ???? ?? ??? ?????:
$versionFilePath = Join-Path $PSScriptRoot "src\Presentation\Dashboard\wwwroot\version.json"

# ????? ???????:
$versionFilePath = Join-Path $PSScriptRoot "YourProjectName\wwwroot\version.json"
# ??
$versionFilePath = Join-Path $PSScriptRoot "src\Web\wwwroot\version.json"

# ?????? service-worker.js:
$serviceWorkerPath = Join-Path $PSScriptRoot "YourProjectName\wwwroot\service-worker.js"

# ? service-worker.published.js:
$serviceWorkerPublishedPath = Join-Path $PSScriptRoot "YourProjectName\wwwroot\service-worker.published.js"
```

---

### ?????? 6: ?????? ???

```powershell
# ???? ????? ???????
cd $newProject

# ???? ????????
.\quick-update.bat
# ???? 1 (Patch)

# ??? ?? ???:
# ? Version updated: 1.0.0 ? 1.0.1
# ? service-worker.js cache version updated
# ? service-worker.published.js cache version updated
```

---

### ?????? 7: ????? ???????

```powershell
# ???? ???????
cd $blazorPath
dotnet run

# ???? ???????
# https://localhost:YOUR_PORT
```

**?? Console (F12):**
```javascript
// ??? ?? ???:
? Version Manager: Initializing...
?? Version stored: 1.0.1
?? Service Worker loaded: v1.0.1
```

---

## ? ?????? ?? ???????

### Checklist ???????:

- [ ] ? Scripts ?? ?????? ???????
- [ ] ? version.json ?? wwwroot
- [ ] ? service-worker.js ?? wwwroot
- [ ] ? service-worker.published.js ?? wwwroot
- [ ] ? version-manager.js ?? wwwroot/js
- [ ] ? index.html ????
- [ ] ? update-version.ps1 ???????? ?????
- [ ] ? quick-update.bat ????
- [ ] ? Console ???? ????? ??????

---

## ?? ????????? ?? ??????? ??????

### ????? ???????:
```powershell
# ??? ??????? ??????!
.\quick-update.bat
```

### ?????:
```powershell
# ??? ???????!
dotnet publish -c Release -o ./publish
```

---

## ?? ????? ??????? ??????

### ????? ???? ?????:

?? `wwwroot/js/version-manager.js`:
```javascript
// ?? 5 ????? ??? 10 ????? (?????)
const VERSION_CHECK_INTERVAL = 600000; // 10 minutes
```

### ????? ???????? ????????:

?? `wwwroot/js/version-manager.js`:
```javascript
const keysToKeep = [
    VERSION_STORAGE_KEY,
    LAST_CHECK_KEY,
    'auth_token',
    'refresh_token',
    'user_preferences',
    'selected_language',
    'your_custom_key' // ?? ??? ???
];
```

### ????? ???????:

?? `wwwroot/js/version-manager.js`:
```javascript
showUpdateNotification: function (version, forceUpdate) {
    const message = forceUpdate 
        ? `????? ??? ??? [??? ??????] (${version})`
        : `????? ???? ?? [??? ??????] (${version})`;
    
    // ...
}
```

---

## ?? ??????? ???????

???? ????? ????? ??????? (???????):

```powershell
# ???? ???????
Copy-Item "$sahlProject\DEPLOYMENT_GUIDE.md" $newProject
Copy-Item "$sahlProject\DEPLOYMENT_QUICK.md" $newProject
Copy-Item "$sahlProject\SERVICE_WORKERS_GUIDE.md" $newProject
Copy-Item "$sahlProject\QUICK_REFERENCE.md" $newProject
Copy-Item "$sahlProject\README_VERSION_SYSTEM.md" $newProject

# ?? ???? ????
Copy-Item "$sahlProject\*.md" $newProject
```

---

## ?? ????!

?????? ???? ???? ?? ?????? ??????! ??

### ?????????:
```powershell
# 1. ????
.\quick-update.bat

# 2. ?????
dotnet run

# 3. ????
dotnet publish -c Release
```

---

## ?? ????? ??????

### ???????: ???????? ??? ?? update-version.ps1

**????:**
```powershell
# ???? ????? ?????:
$versionFilePath = Join-Path $PSScriptRoot "YOUR_PATH_HERE\wwwroot\version.json"
$serviceWorkerPath = Join-Path $PSScriptRoot "YOUR_PATH_HERE\wwwroot\service-worker.js"
$serviceWorkerPublishedPath = Join-Path $PSScriptRoot "YOUR_PATH_HERE\wwwroot\service-worker.published.js"
```

### ???????: version-manager.js ?? ?????

**????:**
???? ??:
1. ????? ?? `wwwroot/js/version-manager.js`
2. ????? ????? ?? `index.html` ??? `</body>`
3. ?????? ????: `<script src="js/version-manager.js"></script>`

### ???????: Service Worker ?? ????

**????:**
???? ??:
1. ?????? HTTPS (?? localhost)
2. `service-worker.js` ?? `wwwroot/` (root)
3. ?? ???? ????? ?? Console

---

## ?? ?????

??? ????? ?????? ????:
- **DEPLOYMENT_GUIDE.md** - ?? ???????
- **SERVICE_WORKERS_GUIDE.md** - ??? ??????

---

<div align="center">

**? ?????? ????? ?????! ??**

**??????? ???? ?? ?? ????? Blazor WebAssembly!**

</div>

@using Dashboard.Pages.Base
@using Resources
@using Resources.Enumerations
@using Shared.DTOs.Payment
@inherits BaseListPage<AdminInvoiceListItemDto>

<div class="card">
    <div class="card-header">
        <div class="card-title">
            <i class="fas fa-file-invoice"></i>
            <span>@AdminResources.Invoices</span>
        </div>
        <div>
            <button class="btn btn-primary" @onclick="OpenCreateModal">
                <i class="fas fa-plus"></i>
                <span>@AdminResources.AddInvoice</span>
            </button>
        </div>
    </div>
    <div class="card-content">
        <div class="bg-white shadow-sm rounded-xl p-6 w-full mb-6 card-container">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 w-full py-3 toolbar">
                <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 flex-grow controls">
                    <EditForm Model="searchModel" OnSubmit="@Search" class="w-full sm:w-auto search-form">
                        <div class="relative w-64 transition-all duration-300 focus-within:w-80 search-box">
                            <input type="text" @bind="searchModel.SearchTerm"
                                   placeholder="@ActionsResources.Search..."
                                   class="w-full px-4 py-2 pr-10 rounded-full border border-gray-300 bg-gray-50 text-gray-800 text-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400 outline-none transition-all duration-200 search-input" />
                            <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-blue-500 hover:text-blue-600 search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </EditForm>
                    <div class="flex items-center gap-2 page-size">
                        <span class="text-gray-600 text-sm page-size-label">Show</span>
                        <select @onchange="OnPageSizeChanged"
                                class="border border-gray-300 rounded-md bg-gray-50 text-gray-700 text-sm px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:border-blue-400 outline-none transition page-size-select">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        @if (items != null && items.Any())
        {
            <table class="data-table">
                <thead>
                    <tr>
                        <th>@FormResources.Date</th>
                        <th>@FormResources.Price</th>
                        <th>@FormResources.Status</th>
                        <th>@ActionsResources.Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var inv in items)
                    {
                        <tr>
                            <td>@(inv.CreatedDateUTC?.ToString("yyyy-MM-dd HH:mm"))</td>
                            <td>@inv.PaymentValue</td>
                            <td>@inv.PaymentState</td>
                            <td class="actions">
                                <div class="d-flex gap-1 justify-content-center">
                                    <button class="btn btn-sm btn-primary" title="@ActionsResources.Edit" @onclick="() => EditInvoice(inv.InvoiceId)">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" title="@ActionsResources.Delete" @onclick="() => DeleteInvoice(inv.InvoiceId)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>@NotifiAndAlertsResources.NoDataFound</p>
            </div>
        }

        <div class="pagination-container">
            <div class="pagination-info">
                @string.Format(ActionsResources.ShowingEntries, StartRecord, EndRecord, totalRecords)
            </div>
            <div class="pagination">
                <button class="pagination-btn" @onclick="() => GoToPage(1)" disabled="@(!CanGoToPreviousPage)">
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button class="pagination-btn" @onclick="() => GoToPage(currentPage - 1)" disabled="@(!CanGoToPreviousPage)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                @{
                    const int maxVisiblePages = 5;
                    int startPage = Math.Max(1, currentPage - 2);
                    int endPage = Math.Min(totalPages, startPage + maxVisiblePages - 1);
                    if (endPage - startPage + 1 < maxVisiblePages)
                    {
                        startPage = Math.Max(1, endPage - maxVisiblePages + 1);
                    }
                }
                @for (int pag = startPage; pag <= endPage; pag++)
                {
                    int pageNumber = pag;
                    <button class="pagination-btn @(pag == currentPage ? "active" : "")" @onclick="() => GoToPage(pageNumber)">@pag</button>
                }
                <button class="pagination-btn" @onclick="() => GoToPage(currentPage + 1)" disabled="@(!CanGoToNextPage)">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button class="pagination-btn" @onclick="() => GoToPage(totalPages)" disabled="@(!CanGoToNextPage)">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>

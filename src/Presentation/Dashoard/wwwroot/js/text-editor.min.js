function setupTinyMCEErrorHandlers(){if(typeof tinymce!="undefined"){tinymce.on("AddEditor",function(n){console.log(`TinyMCE Editor added: ${n.editor.id}`)});tinymce.on("RemoveEditor",function(n){console.log(`TinyMCE Editor removed: ${n.editor.id}`)})}}if(window.textEditor={instances:{},initialize:function(n,t,i,r=false,u=400){return(console.log(`Initializing editor with ID: "${n}"`),!n)?(console.error("ElementId is null or undefined"),Promise.reject(new Error("ElementId is required"))):typeof n!="string"?(console.error(`ElementId must be a string, got ${typeof n}: ${n}`),Promise.reject(new Error("ElementId must be a string"))):(this.showLoadingIndicator(n),typeof tinymce=="undefined"?(console.log("TinyMCE not loaded, loading on demand..."),window.ScriptLoader.loadTinyMCE().then(()=>(console.log("TinyMCE loaded successfully, initializing editor..."),this.initializeEditor(n,t,i,r,u))).catch(t=>(console.error("Failed to load TinyMCE:",t),this.showErrorIndicator(n,"Failed to load text editor: "+t.message),Promise.reject(t)))):(console.log("TinyMCE already available, initializing editor..."),this.initializeEditor(n,t,i,r,u)))},showLoadingIndicator:function(n){try{const t=document.getElementById(n);if(t){t.style.background="#f8f9fa";t.style.border="1px dashed #dee2e6";t.style.borderRadius="0.375rem";t.style.padding="20px";t.style.textAlign="center";t.style.color="#6c757d";t.value="";t.placeholder="Loading text editor...";t.disabled=!0;const n=document.createElement("div");n.className="spinner-border spinner-border-sm text-primary";n.style.marginRight="8px";n.setAttribute("role","status");t.previousElementSibling&&t.previousElementSibling.classList.contains("loading-spinner")||(n.classList.add("loading-spinner"),t.parentNode.insertBefore(n,t))}}catch(t){console.error("Error showing loading indicator:",t)}},showErrorIndicator:function(n,t){try{const i=document.getElementById(n);if(i){const r=i.parentNode.querySelector(".loading-spinner");if(r&&r.remove(),i.style.background="#f8d7da",i.style.border="1px solid #f5c6cb",i.style.borderRadius="0.375rem",i.style.padding="20px",i.style.textAlign="center",i.style.color="#721c24",i.value="",i.placeholder=t||"Failed to load text editor",i.disabled=!0,!i.nextElementSibling||!i.nextElementSibling.classList.contains("retry-btn")){const t=document.createElement("button");t.innerHTML='<i class="fas fa-redo"><\/i> Retry';t.className="btn btn-sm btn-outline-primary mt-2 retry-btn";t.onclick=()=>{t.remove(),this.resetElementStyles(n),this.initialize(n,"",null)};i.parentNode.insertBefore(t,i.nextSibling)}}}catch(i){console.error("Error showing error indicator:",i)}},resetElementStyles:function(n){try{const t=document.getElementById(n);if(t){t.style.background="";t.style.border="";t.style.borderRadius="";t.style.padding="";t.style.textAlign="";t.style.color="";t.disabled=!1;t.style.display="";t.placeholder="Enter content...";const n=t.parentNode.querySelector(".loading-spinner");n&&n.remove();const i=t.parentNode.querySelector(".retry-btn");i&&i.remove()}}catch(t){console.error("Error resetting element styles:",t)}},initializeEditor:function(n,t,i,r=false,u=400){return new Promise((f,e)=>{try{console.log(`Starting TinyMCE initialization for ${n}`);this.instances[n]&&(console.log(`Destroying existing instance for ${n}`),this.destroy(n));const s=document.getElementById(n);if(!s){const t=`Element with id "${n}" not found in DOM`;console.error(t);e(new Error(t));return}if(this.resetElementStyles(n),typeof tinymce=="undefined"){const n="TinyMCE is not loaded";console.error(n);e(new Error(n));return}const o=setTimeout(()=>{console.error(`TinyMCE initialization timeout for ${n}`),this.showErrorIndicator(n,"Editor initialization timeout"),e(new Error("TinyMCE initialization timeout"))},1e4),h={selector:"#"+n,height:u||400,menubar:!1,branding:!1,promotion:!1,plugins:["advlist","autolink","lists","link","image","charmap","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","help","wordcount"],toolbar:r?!1:"undo redo | blocks | bold italic forecolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | help",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px; padding: 10px; }",readonly:r||!1,init_instance_callback:function(i){clearTimeout(o);console.log(`Editor "${n}" initialized successfully via callback`);try{i.setContent(t||"");f(!0)}catch(r){console.error("Error setting initial content:",r);e(r)}},setup:function(t){t.on("init",function(){console.log(`Editor "${n}" setup init event fired`)});t.on("LoadContent",function(){console.log(`Content loaded for editor "${n}"`)});t.on("Error",function(t){clearTimeout(o);console.error(`TinyMCE Error for editor "${n}":`,t);e(new Error(`TinyMCE Error: ${t.message||"Unknown error"}`))});if(!r&&i){let r;const n=function(){clearTimeout(r);r=setTimeout(function(){try{const n=t.getContent();i&&i.invokeMethodAsync&&i.invokeMethodAsync("OnContentChanged",n).catch(n=>console.error("Error invoking OnContentChanged:",n))}catch(n){console.error("Error in handleContentChange:",n)}},500)};t.on("input",n);t.on("change",n);t.on("blur",n)}}};console.log(`Initializing TinyMCE with config for ${n}`);tinymce.init(h);this.instances[n]={initialized:!0,dotNetRef:i,readonly:r};console.log(`Editor "${n}" setup completed`)}catch(o){console.error(`Error initializing TinyMCE for "${n}":`,o);this.showErrorIndicator(n,"Initialization error: "+o.message);e(o)}})},setContent:function(n,t){if(console.log(`Setting content for editor: "${n}"`),!n)return console.error("ElementId is null or undefined in setContent"),!1;try{const i=tinymce.get(n);return i&&i.initialized?(i.setContent(t||""),console.log(`Content set successfully for "${n}"`),!0):(console.warn(`Editor "${n}" not found or not initialized`),!1)}catch(i){return console.error(`Error setting content for "${n}":`,i),!1}},getContent:function(n){if(!n)return console.error("ElementId is null or undefined in getContent"),"";try{const t=tinymce.get(n);return t&&t.initialized?t.getContent():(console.warn(`Editor "${n}" not found or not initialized`),"")}catch(t){return console.error(`Error getting content for "${n}":`,t),""}},getWordCount:function(n){if(!n)return console.error("ElementId is null or undefined in getWordCount"),0;try{const t=tinymce.get(n);return t&&t.initialized&&t.plugins.wordcount?t.plugins.wordcount.getCount():0}catch(t){return console.error(`Error getting word count for "${n}":`,t),0}},getCharCount:function(n){if(!n)return console.error("ElementId is null or undefined in getCharCount"),0;try{const t=tinymce.get(n);return t&&t.initialized?t.getContent({format:"text"}).length:0}catch(t){return console.error(`Error getting char count for "${n}":`,t),0}},insertContent:function(n,t){if(!n)return console.error("ElementId is null or undefined in insertContent"),!1;try{const i=tinymce.get(n);return i&&i.initialized?(i.insertContent(t||""),!0):(console.warn(`Editor "${n}" not found or not initialized`),!1)}catch(i){return console.error(`Error inserting content for "${n}":`,i),!1}},focus:function(n){if(!n)return console.error("ElementId is null or undefined in focus"),!1;try{const t=tinymce.get(n);return t&&t.initialized?(t.focus(),!0):(console.warn(`Editor "${n}" not found or not initialized`),!1)}catch(t){return console.error(`Error focusing editor "${n}":`,t),!1}},destroy:function(n){if(!n)return console.error("ElementId is null or undefined in destroy"),!1;try{const t=tinymce.get(n);return t&&(t.destroy(),console.log(`Editor "${n}" destroyed`)),delete this.instances[n],this.resetElementStyles(n),!0}catch(t){return console.error(`Error destroying editor "${n}":`,t),!1}}},typeof tinymce!="undefined")setupTinyMCEErrorHandlers();else{let n=setInterval(()=>{typeof tinymce!="undefined"&&(setupTinyMCEErrorHandlers(),clearInterval(n))},100);setTimeout(()=>clearInterval(n),5e3)}
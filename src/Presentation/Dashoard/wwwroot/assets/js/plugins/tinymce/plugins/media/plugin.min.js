(function(){"use strict";function bf(){si.add("media",function(n){return tf.register(n),wf.register(n),lf.setup(n),hf.setup(n),vf.setup(n),gu.get(n)})}var si=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=function(){return n=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},n.apply(this,arguments)},hi=function(){},f=function(n){return function(){return n}},c=f(!1),b=f(!0),l=function(){return k},k=function(){var n=function(n){return n.isNone()},t=function(n){return n()},i=function(n){return n},r={fold:function(n){return n()},is:c,isSome:c,isNone:b,getOr:i,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.");},getOrNull:f(null),getOrUndefined:f(undefined),or:i,orThunk:t,map:l,each:hi,bind:l,exists:c,forall:b,filter:l,equals:n,equals_:n,toArray:function(){return[]},toString:f("none()")};return Object.freeze&&Object.freeze(r),r}(),d=function(n){var t=f(n),u=function(){return r},i=function(t){return t(n)},r={fold:function(t,i){return i(n)},is:function(t){return n===t},isSome:b,isNone:c,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:u,orThunk:u,map:function(t){return d(t(n))},each:function(t){t(n)},bind:i,exists:i,forall:i,filter:function(t){return t(n)?r:k},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,i){return t.fold(c,function(t){return i(n,t)})}};return r},ci=function(n){return n===null||n===undefined?k:d(n)},e={some:d,none:l,from:ci},li=function(n){if(n===null)return"null";var t=typeof n;return t==="object"&&(Array.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="Array")?"array":t==="object"&&(String.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="String")?"string":t},a=function(n){return function(t){return li(t)===n}},ai=a("string"),et=a("object"),vi=a("array"),yi=a("function"),pi=Array.prototype.slice,wi=Array.prototype.push,ot=function(n,t){for(var u,i=0,r=n.length;i<r;i++)u=n[i],t(u,i)},bi=function(n){for(var i=[],t=0,r=n.length;t<r;++t){if(!vi(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);wi.apply(i,n[t])}return i},kf=yi(Array.from)?Array.from:function(n){return pi.call(n)},st=function(n){var t=n,i=function(){return t},r=function(n){t=n},u=function(){return st(i())};return{get:i,set:r,clone:u}},ki=Object.hasOwnProperty,i=function(n,t){return di(n,t)?e.from(n[t]):e.none()},di=function(n,t){return ki.call(n,t)},gi=function(n){return n.getParam("media_scripts")},nr=function(n){return n.getParam("audio_template_callback")},tr=function(n){return n.getParam("video_template_callback")},ir=function(n){return n.getParam("media_live_embeds",!0)},rr=function(n){return n.getParam("media_filter_html",!0)},ur=function(n){return n.getParam("media_url_resolver")},fr=function(n){return n.getParam("media_alt_source",!0)},er=function(n){return n.getParam("media_poster",!0)},or=function(n){return n.getParam("media_dimensions",!0)},t={getScripts:gi,getAudioTemplateCallback:nr,getVideoTemplateCallback:tr,hasLiveEmbeds:ir,shouldFilterHtml:rr,getUrlResolver:ur,hasAltSource:fr,hasPoster:er,hasDimensions:or},r=tinymce.util.Tools.resolve("tinymce.util.Tools"),v=tinymce.util.Tools.resolve("tinymce.html.SaxParser"),ht=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),sr=function(n){return n.replace(/px$/,"")},hr=function(n){return/^[0-9.]+$/.test(n)?n+"px":n},ct=function(n){return function(t){return t?sr(t.style[n]):""}},lt=function(n){return function(t,i){t&&(t.style[n]=hr(i))}},y={getMaxWidth:ct("maxWidth"),getMaxHeight:ct("maxHeight"),setMaxWidth:lt("maxWidth"),setMaxHeight:lt("maxHeight")},g=function(n,t){if(n)for(var i=0;i<n.length;i++)if(t.indexOf(n[i].filter)!==-1)return n[i]},nt=ht.DOM,at=function(n){return nt.getAttrib(n,"data-ephox-embed-iri")},cr=function(n){var t=nt.createFragment(n);return at(t.firstChild)!==""},lr=function(n,t){var i={};return v({validate:!1,allow_conditional_comments:!0,start:function(t,u){if(i.source||t!=="param"||(i.source=u.map.movie),(t==="iframe"||t==="object"||t==="embed"||t==="video"||t==="audio")&&(i.type||(i.type=t),i=r.extend(u.map,i)),t==="script"){var f=g(n,u.map.src);if(!f)return;i={type:"script",source:u.map.src,width:String(f.width),height:String(f.height)}}t==="source"&&(i.source?i.altsource||(i.altsource=u.map.src):i.source=u.map.src);t!=="img"||i.poster||(i.poster=u.map.src)}}).parse(t),i.source=i.source||i.src||i.data,i.altsource=i.altsource||"",i.poster=i.poster||"",i},ar=function(n){var i=nt.createFragment(n),t=i.firstChild;return{type:"ephox-embed-iri",source:at(t),altsource:"",poster:"",width:y.getMaxWidth(t),height:y.getMaxHeight(t)}},tt=function(n,t){return cr(t)?ar(t):lr(n,t)},vr=function(n){var i=n.toLowerCase().split(".").pop(),t={mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"}[i];return t?t:""},vt={guess:vr},it=tinymce.util.Tools.resolve("tinymce.html.Writer"),yt=tinymce.util.Tools.resolve("tinymce.html.Schema"),rt=ht.DOM,u=function(n,t){var i,u,r,f;for(i in t)if(r=""+t[i],n.map[i])for(u=n.length;u--;)f=n[u],f.name===i&&(r?(n.map[i]=r,f.value=r):(delete n.map[i],n.splice(u,1)));else r&&(n.push({name:i,value:r}),n.map[i]=r)},yr=function(n){var t=it(),i=v(t);return i.parse(n),t.getContent()},o=["source","altsource"],pr=function(n,t,i){var r=it(),f=0,e;return v({validate:!1,allow_conditional_comments:!0,comment:function(n){r.comment(n)},cdata:function(n){r.cdata(n)},text:function(n,t){r.text(n,t)},start:function(n,s,h){switch(n){case"video":case"object":case"embed":case"img":case"iframe":t.height!==undefined&&t.width!==undefined&&u(s,{width:t.width,height:t.height})}if(i)switch(n){case"video":u(s,{poster:t.poster,src:""});t.altsource&&u(s,{src:""});break;case"iframe":u(s,{src:t.source});break;case"source":if(f<2&&(u(s,{src:t[o[f]],type:t[o[f]+"mime"]}),!t[o[f]]))return;f++;break;case"img":if(!t.poster)return;e=!0}r.start(n,s,h)},end:function(n){var s,h,c;if(n==="video"&&i)for(s=0;s<2;s++)t[o[s]]&&(h=[],h.map={},f<s&&(u(h,{src:t[o[s]],type:t[o[s]+"mime"]}),r.start("source",h,!0)));t.poster&&n==="object"&&i&&!e&&(c=[],c.map={},u(c,{src:t.poster,width:t.width,height:t.height}),r.start("img",c,!0));r.end(n)}},yt({})).parse(n),r.getContent()},wr=function(n){var t=rt.createFragment(n);return rt.getAttrib(t.firstChild,"data-ephox-embed-iri")!==""},br=function(n,t){var r=rt.createFragment(n),i=r.firstChild;return y.setMaxWidth(i,t.width),y.setMaxHeight(i,t.height),yr(i.outerHTML)},kr=function(n,t,i){return wr(n)?br(n,t):pr(n,t,i)},ut={updateHtml:kr},dr=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],gr=function(n){var t=n.match(/^(https?:\/\/|www\.)(.+)$/i);return t&&t.length>1?t[1]==="www."?"https://":t[1]:"https://"},nu=function(n,t){for(var f=gr(t),i=n.regex.exec(t),r=f+n.url,e=function(n){r=r.replace("$"+n,function(){return i[n]?i[n]:""})},u=0;u<i.length;u++)e(u);return r.replace(/\?$/,"")},tu=function(n){var t=dr.filter(function(t){return t.regex.test(n)});return t.length>0?r.extend({},t[0],{url:nu(t[0],n)}):null},iu=function(n){var t=n.allowFullscreen?' allowFullscreen="1"':"";return'<iframe src="'+n.source+'" width="'+n.width+'" height="'+n.height+'"'+t+"><\/iframe>"},ru=function(n){var t='<object data="'+n.source+'" width="'+n.width+'" height="'+n.height+'" type="application/x-shockwave-flash">';return n.poster&&(t+='<img src="'+n.poster+'" width="'+n.width+'" height="'+n.height+'" />'),t+"<\/object>"},uu=function(n,t){return t?t(n):'<audio controls="controls" src="'+n.source+'">'+(n.altsource?'\n<source src="'+n.altsource+'"'+(n.altsourcemime?' type="'+n.altsourcemime+'"':"")+" />\n":"")+"<\/audio>"},fu=function(n,t){return t?t(n):'<video width="'+n.width+'" height="'+n.height+'"'+(n.poster?' poster="'+n.poster+'"':"")+' controls="controls">\n<source src="'+n.source+'"'+(n.sourcemime?' type="'+n.sourcemime+'"':"")+" />\n"+(n.altsource?'<source src="'+n.altsource+'"'+(n.altsourcemime?' type="'+n.altsourcemime+'"':"")+" />\n":"")+"<\/video>"},eu=function(n){return'<script src="'+n.source+'"><\/script>'},pt=function(n,i){var u=r.extend({},i),f,e,o,s;return!u.source&&(r.extend(u,tt(t.getScripts(n),u.embed)),!u.source)?"":(u.altsource||(u.altsource=""),u.poster||(u.poster=""),u.source=n.convertURL(u.source,"source"),u.altsource=n.convertURL(u.altsource,"source"),u.sourcemime=vt.guess(u.source),u.altsourcemime=vt.guess(u.altsource),u.poster=n.convertURL(u.poster,"poster"),f=tu(u.source),f&&(u.source=f.url,u.type=f.type,u.allowFullscreen=f.allowFullscreen,u.width=u.width||String(f.w),u.height=u.height||String(f.h)),u.embed?ut.updateHtml(u.embed,u,!0):(e=g(t.getScripts(n),u.source),e&&(u.type="script",u.width=String(e.width),u.height=String(e.height)),o=t.getAudioTemplateCallback(n),s=t.getVideoTemplateCallback(n),u.width=u.width||"300",u.height=u.height||"150",r.each(u,function(t,i){u[i]=n.dom.encode(""+t)}),u.type==="iframe"?iu(u):u.sourcemime==="application/x-shockwave-flash"?ru(u):u.sourcemime.indexOf("audio")!==-1?uu(u,o):u.type==="script"?eu(u):fu(u,s)))},wt=tinymce.util.Tools.resolve("tinymce.util.Promise"),p={},ou=function(n,t,i){return new wt(function(r,u){var f=function(i){return i.html&&(p[n.source]=i),r({url:n.source,html:i.html?i.html:t(n)})};p[n.source]?f(p[n.source]):i({url:n.source},f,u)})},su=function(n,t){return new wt(function(i){i({html:t(n),url:n.source})})},bt=function(n){return function(t){return pt(n,t)}},hu=function(n,i){var r=t.getUrlResolver(n);return r?ou(i,bt(n),r):su(i,bt(n))},cu=function(n){return p.hasOwnProperty(n)},ft={getEmbedHtml:hu,isCached:cu},lu=function(n,t){return i(t,n).bind(function(n){return i(n,"meta")})},au=function(n,t,r){return function(u){var f,s=function(){return i(n,u)},o=function(){return i(t,u)},h=function(n){return i(n,"value").bind(function(n){return n.length>0?e.some(n):e.none()})},c=function(){return s().bind(function(n){return et(n)?h(n).orThunk(o):o().orThunk(function(){return e.from(n)})})},l=function(){return o().orThunk(function(){return s().bind(function(n){return et(n)?h(n):e.from(n)})})};return f={},f[u]=(u===r?c():l()).getOr(""),f}},vu=function(n,t){var r={};return i(n,"dimensions").each(function(n){ot(["width","height"],function(u){i(t,u).orThunk(function(){return i(n,u)}).each(function(n){return r[u]=n})})}),r},s=function(t,i){var u=i?lu(i,t).getOr({}):{},r=au(t,u,i);return n(n(n(n(n({},r("source")),r("altsource")),r("poster")),r("embed")),vu(t,u))},w=function(t){var r=n(n({},t),{source:{value:i(t,"source").getOr("")},altsource:{value:i(t,"altsource").getOr("")},poster:{value:i(t,"poster").getOr("")}});return ot(["width","height"],function(n){i(t,n).each(function(t){var i=r.dimensions||{};i[n]=t;r.dimensions=i})}),r},kt=function(n){return function(t){var i=t&&t.msg?"Media embed handler error: "+t.msg:"Media embed handler threw unknown error.";n.notificationManager.open({type:"error",text:i})}},dt=function(n,i){return tt(t.getScripts(n),i)},yu=function(n){return n.getAttribute("data-mce-object")||n.getAttribute("data-ephox-embed-iri")},pu=function(i){var r=i.selection.getNode(),u=yu(r)?i.serializer.serialize(r,{selection:!0}):"";return n({embed:u},tt(t.getScripts(i),u))},gt=function(t,i){return function(r){if(ai(r.url)&&r.url.trim().length>0){var u=r.html,f=dt(i,u),e=n(n({},f),{source:r.url,embed:u});t.setData(w(e))}}},wu=function(n,t){for(var i,r=n.dom.select("img[data-mce-object]"),u=0;u<t.length;u++)for(i=r.length-1;i>=0;i--)t[u]===r[i]&&r.splice(i,1);n.selection.select(r[0])},ni=function(n,t){var i=n.dom.select("img[data-mce-object]");n.insertContent(t);wu(n,i);n.nodeChanged()},bu=function(n,t,i){t.embed=ut.updateHtml(t.embed,t);t.embed&&(n.source===t.source||ft.isCached(t.source))?ni(i,t.embed):ft.getEmbedHtml(i,t).then(function(n){ni(i,n.html)}).catch(kt(i))},ku=function(i){var o=pu(i),u=st(o),l=w(o),a=function(n,t){var r=s(t.getData(),"source");n.source!==r.source&&(gt(e,i)({url:r.source,html:""}),ft.getEmbedHtml(i,r).then(gt(e,i)).catch(kt(i)))},v=function(n){var t=s(n.getData()),r=dt(i,t.embed);n.setData(w(r))},y=function(t,r){var u=s(t.getData(),r),f=pt(i,u);t.setData(w(n(n({},u),{embed:f})))},p=t.hasDimensions(i)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],b={title:"General",name:"general",items:bi([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],p])},r=[],h,f,c,e;t.hasAltSource(i)&&r.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"});t.hasPoster(i)&&r.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});h={title:"Advanced",name:"advanced",items:r};f=[b,{title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]}];r.length>0&&f.push(h);c={type:"tabpanel",tabs:f};e=i.windowManager.open({title:"Insert/Edit Media",size:"normal",body:c,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(n){var t=s(n.getData());bu(u.get(),t,i);n.close()},onChange:function(n,t){switch(t.name){case"source":a(u.get(),n);break;case"embed":v(n);break;case"dimensions":case"altsource":case"poster":y(n,t.name)}u.set(s(n.getData()))},initialData:l})},ti={showDialog:ku,unwrap:s},du=function(n){var t=function(){ti.showDialog(n)};return{showDialog:t}},gu={get:du},nf=function(n){var t=function(){ti.showDialog(n)};n.addCommand("mceMedia",t)},tf={register:nf},h=tinymce.util.Tools.resolve("tinymce.html.Node"),ii=tinymce.util.Tools.resolve("tinymce.Env"),rf=function(n,i){if(t.shouldFilterHtml(n)===!1)return i;var r=it(),u;return v({validate:!1,allow_conditional_comments:!1,comment:function(n){r.comment(n)},cdata:function(n){r.cdata(n)},text:function(n,t){r.text(n,t)},start:function(t,i,f){if(u=!0,t!=="script"&&t!=="noscript"){for(var e=0;e<i.length;e++){if(i[e].name.indexOf("on")===0)return;i[e].name==="style"&&(i[e].value=n.dom.serializeStyle(n.dom.parseStyle(i[e].value),t))}r.start(t,i,f);u=!1}},end:function(n){u||r.end(n)}},yt({})).parse(i),r.getContent()},ri={sanitize:rf},ui=function(n,t){var i,r=t.name;return i=new h("img",1),i.shortEnded=!0,ei(n,t,i),i.attr({width:t.attr("width")||"300",height:t.attr("height")||(r==="audio"?"30":"150"),style:t.attr("style"),src:ii.transparentSrc,"data-mce-object":r,"class":"mce-object mce-object-"+r}),i},fi=function(n,t){var i,r,u,f=t.name;return i=new h("span",1),i.attr({contentEditable:"false",style:t.attr("style"),"data-mce-object":f,"class":"mce-preview-object mce-object-"+f}),ei(n,t,i),r=new h(f,1),r.attr({src:t.attr("src"),allowfullscreen:t.attr("allowfullscreen"),style:t.attr("style"),"class":t.attr("class"),width:t.attr("width"),height:t.attr("height"),frameborder:"0"}),u=new h("span",1),u.attr("class","mce-shim"),i.append(r),i.append(u),i},ei=function(n,t,i){for(var r,u,o,f=t.attributes,e=f.length;e--;)r=f[e].name,u=f[e].value,r!=="width"&&r!=="height"&&r!=="style"&&((r==="data"||r==="src")&&(u=n.convertURL(u,r)),i.attr("data-mce-p-"+r,u));o=t.firstChild&&t.firstChild.value;o&&(i.attr("data-mce-html",escape(ri.sanitize(n,o))),i.firstChild=null)},uf=function(n){var t=n.attr("class");return t&&/\btiny-pageembed\b/.test(t)},oi=function(n){while(n=n.parent)if(n.attr("data-ephox-embed-iri")||uf(n))return!0;return!1},ff=function(n){return function(i){for(var f=i.length,r,u;f--;)(r=i[f],r.parent)&&(r.parent.attr("data-mce-object")||(r.name!=="script"||(u=g(t.getScripts(n),r.attr("src")),u))&&(u&&(u.width&&r.attr("width",u.width.toString()),u.height&&r.attr("height",u.height.toString())),r.name==="iframe"&&t.hasLiveEmbeds(n)&&ii.ceFalse?oi(r)||r.replace(fi(n,r)):oi(r)||r.replace(ui(n,r))))}},ef={createPreviewIframeNode:fi,createPlaceholderNode:ui,placeHolderConverter:ff},sf=function(n){n.on("preInit",function(){var i=n.schema.getSpecialElements(),t;r.each("video audio iframe object".split(" "),function(n){i[n]=new RegExp("<\/"+n+"[^>]*>","gi")});t=n.schema.getBoolAttrs();r.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(n){t[n]={}});n.parser.addNodeFilter("iframe,video,audio,object,embed,script",ef.placeHolderConverter(n));n.serializer.addAttributeFilter("data-mce-object",function(t,i){for(var v=t.length,r,u,e,o,c,s,f,l,a;v--;)if(r=t[v],r.parent){for(f=r.attr(i),u=new h(f,1),f!=="audio"&&f!=="script"&&(l=r.attr("class"),l&&l.indexOf("mce-preview-object")!==-1?u.attr({width:r.firstChild.attr("width"),height:r.firstChild.attr("height")}):u.attr({width:r.attr("width"),height:r.attr("height")})),u.attr({style:r.attr("style")}),o=r.attributes,e=o.length;e--;)a=o[e].name,a.indexOf("data-mce-p-")===0&&u.attr(a.substr(11),o[e].value);f==="script"&&u.attr("type","text/javascript");c=r.attr("data-mce-html");c&&(s=new h("#text",3),s.raw=!0,s.value=ri.sanitize(n,unescape(c)),u.append(s));r.replace(u)}})});n.on("SetContent",function(){n.$("span.mce-preview-object").each(function(t,i){var r=n.$(i);r.find("span.mce-shim").length===0&&r.append('<span class="mce-shim"><\/span>')})})},hf={setup:sf},cf=function(n){n.on("ResolveName",function(n){var t;n.target.nodeType===1&&(t=n.target.getAttribute("data-mce-object"))&&(n.name=t)})},lf={setup:cf},af=function(n){n.on("click keyup touchend",function(){var t=n.selection.getNode();t&&n.dom.hasClass(t,"mce-preview-object")&&n.dom.getAttrib(t,"data-mce-selected")&&t.setAttribute("data-mce-selected","2")});n.on("ObjectSelected",function(n){var t=n.target.getAttribute("data-mce-object");(t==="audio"||t==="script")&&n.preventDefault()});n.on("ObjectResized",function(n){var i=n.target,t;i.getAttribute("data-mce-object")&&(t=i.getAttribute("data-mce-html"),t&&(t=unescape(t),i.setAttribute("data-mce-html",escape(ut.updateHtml(t,{width:String(n.width),height:String(n.height)})))))})},vf={setup:af},yf=function(n,t){return function(i){return n.selection.selectorChangedWithUnbind(t.join(","),i.setActive).unbind}},pf=function(n){n.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:function(){n.execCommand("mceMedia")},onSetup:yf(n,["img[data-mce-object]","span[data-mce-object]","div[data-ephox-embed-iri]"])});n.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:function(){n.execCommand("mceMedia")}})},wf={register:pf};bf()})();
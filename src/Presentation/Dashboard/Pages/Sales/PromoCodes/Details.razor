@page "/promocode"
@page "/promocode/{id:guid}"

@using Common.Enumerations
@using Common.Enumerations.FieldType
@using Common.Enumerations.PromoCode
@using Common.Enumerations.User
@using Shared.DTOs.ECommerce
@using Shared.DTOs.ECommerce.Item
@using Shared.DTOs.User
@attribute [Authorize(Roles = nameof(UserRole.Admin))]

<PageTitle>@ECommerceResources.PromoCodes</PageTitle>

<div class="container-fluid p-0">
    <div class="card shadow-sm border-0">
        <div class="card-header d-flex bg-primary justify-content-between align-items-center">
            <h4 class="modal-title text-white">
                @(Model.Id == Guid.Empty ? $"➕ {ActionsResources.Add}" : $"✏️ {ActionsResources.Edit}")
                @FormResources.PromoCode
            </h4>
        </div>

        <div class="card-body p-4">
            <div class="row g-3">
                <EditForm Model="@Model" id="mainForm" OnValidSubmit="Save">
                    <DataAnnotationsValidator />
                    <!-- Basic Information -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.ArabicTitle:</label>
                            <InputText class="form-control" @bind-Value="Model.TitleAR"
                                       placeholder="@String.Format(FormResources.ArabicTitle)" />
                            <ValidationMessage For="@(() => Model.TitleAR)" />
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.EnglishTitle:</label>
                            <InputText class="form-control" @bind-Value="Model.TitleEN"
                                       placeholder="@String.Format(FormResources.EnglishTitle)" />
                            <ValidationMessage For="@(() => Model.TitleEN)" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.Code:</label>
                            <InputText class="form-control" @bind-Value="Model.Code"
                                       placeholder="@String.Format(FormResources.Code)" />
                            <ValidationMessage For="@(() => Model.Code)" />
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.PromoCodeType:</label>
                            <InputSelect class="form-control" @bind-Value="Model.PromoCodeType">
                                @foreach (var type in Enum.GetValues(typeof(PromoCodeType)))
                                {
                                    <option value="@type">@type.ToString()</option>
                                }
                            </InputSelect>
                            <ValidationMessage For="@(() => Model.PromoCodeType)" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.Value:</label>
                            <InputNumber class="form-control" @bind-Value="Model.Value"
                                         placeholder="@String.Format(FormResources.Value)" />
                            <ValidationMessage For="@(() => Model.Value)" />
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.UsageLimit:</label>
                            <InputNumber class="form-control" @bind-Value="Model.UsageLimit"
                                         placeholder="@String.Format(FormResources.UsageLimit)" />
                            <ValidationMessage For="@(() => Model.UsageLimit)" />
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.StartDate:</label>
                            <InputDate class="form-control" @bind-Value="Model.StartDate" min="@DateTime.Today.ToString("yyyy-MM-dd")" />
                            <ValidationMessage For="@(() => Model.StartDate)" />
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.EndDate:</label>
                            <InputDate class="form-control" @bind-Value="Model.EndDate" min="@DateTime.Today.ToString("yyyy-MM-dd")" />
                            <ValidationMessage For="@(() => Model.EndDate)" />
                        </div>
                    </div>
                </EditForm>
            </div>
        </div>

       <div class="card-footer bg-light py-3 d-flex justify-content-end gap-2">
    <!-- زر الإلغاء -->
    <button type="button" class="btn btn-secondary btn-responsive d-flex align-items-center" @onclick="CloseModal">
        <i class="fas fa-times me-2 ms-2"></i>
        <span class="btn-text">@ActionsResources.Cancel</span>
    </button>

    <!-- زر الحفظ -->
    <button type="submit" form="mainForm" class="btn btn-primary btn-responsive d-flex align-items-center" disabled="@_isSaving">
        @if (_isSaving)
        {
            <span class="spinner-border spinner-border-sm mx-2" role="status" aria-hidden="true"></span>
            <span class="btn-text">@FormResources.Saving</span>
        }
        else
        {
            <i class="fas fa-save mx-2 ms-2"></i>
            <span class="btn-text">@ActionsResources.Save</span>
        }
    </button>
</div>

    </div>
</div>
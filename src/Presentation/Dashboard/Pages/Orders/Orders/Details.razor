@page "/order/orders/{id:guid}"
@page "/orders/{id:guid}"

@attribute [Authorize(Roles = nameof(UserRole.Admin))]
@using Common.Enumerations
@using Common.Enumerations.Order
@using Common.Enumerations.Payment
@using Common.Enumerations.Shipping
@using Common.Enumerations.User
@using Dashboard.Pages.Base
@using Dashboard.Pages.Orders.Orders.Components
@using Shared.DTOs.Order.OrderProcessing.AdminOrder
@inherits LocalizedComponentBase
@inject IJSRuntime JS

<PageTitle>@OrderResources.OrderDetails - #@Order.OrderNumber</PageTitle>

@if (IsLoading)
{
    <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">@GeneralResources.Loading...</span>
        </div>
        <p class="text-muted mt-2">@GeneralResources.Loading...</p>
    </div>
}
else
{
    <div class="container-fluid p-0 order-details-page">
        <OrderDetailsHeader Order="Order"
                           OnBackClick="NavigateToList"
                           FormatDateTime="FormatDateTime"
                           GetOrderStatusBadgeClass="GetOrderStatusBadgeClass"
                           GetOrderStatusText="GetOrderStatusText"
                           GetPaymentStatusClass="GetPaymentStatusClass"
                           GetPaymentStatusText="GetPaymentStatusText" />

        <OrderDetailsActionsSummary Order="Order"
                                   CanMoveToNextStatus="@CanMoveToNextStatus()"
                                   MoveToNextStatusAsync="MoveToNextStatusAsync"
                                   GetNextStatusButtonIcon="@GetNextStatusButtonIcon()"
                                   GetNextStatusButtonText="@GetNextStatusButtonText()"
                                   FormatCurrency="FormatCurrency" />

        <div class="row">
            <div class="col-12">
                <OrderDetailsTabsNav ActiveTab="ActiveTab"
                                    SetActiveTab="OnTabChangedAsync"
                                    Order="Order" />

                <div class="tab-content-wrapper">
                    @if (ActiveTab == "customer")
                    {
                        <OrderDetailsCustomerTab Order="Order"
                                                 GetPaymentMethodDisplay="GetPaymentMethodDisplay"
                                                 FormatDateTime="FormatDateTime"
                                                 FormatCurrency="FormatCurrency" />
                    }

                    @if (ActiveTab == "items")
                    {
                        <OrderDetailsItemsTab Order="Order"
                                             BaseUrl="BaseUrl"
                                             FormatCurrency="FormatCurrency"
                                             GetShipmentStatusBadgeClass="GetShipmentStatusBadgeClass"
                                             GetShipmentStatusText="GetShipmentStatusText" />
                    }

                    @if (ActiveTab == "shipments")
                    {
                        <OrderDetailsShipmentsTab Order="Order"
                                                 BaseUrl="BaseUrl"
                                                 FormatCurrency="FormatCurrency"
                                                 ShipmentUpdatingId="ShipmentUpdatingId"
                                                 GetShipmentStatusBadgeClass="GetShipmentStatusBadgeClass"
                                                 GetShipmentStatusText="GetShipmentStatusText"
                                                 CanShipmentMoveNext="CanShipmentMoveNext"
                                                 MoveShipmentToNextStatusAsync="MoveShipmentToNextStatusAsync"
                                                 GetShipmentActionButtonClass="GetShipmentActionButtonClass"
                                                 GetShipmentNextAction="GetShipmentNextAction"
                                                 GetShipmentActionIcon="GetShipmentActionIcon"
                                                 CanCancelShipment="CanCancelShipment"
                                                 CancelShipmentAsync="CancelShipmentAsync"
                                                 CanMarkDeliveryFailed="CanMarkDeliveryFailed"
                                                 MarkShipmentDeliveryFailedAsync="MarkShipmentDeliveryFailedAsync" />
                    }
                </div>
            </div>
        </div>
    </div>
}

@page "/users/customer/details/{id:guid}"

@inherits LocalizedComponentBase
@attribute [Authorize(Roles = nameof(UserRole.Admin))]
@using Common.Enumerations.User
@using Shared.DTOs.Customer
@using Dashboard.Pages.UserManagement.Customers

<PageTitle>@ECommerceResources.CustomerDetails</PageTitle>

<div class="container-fluid">
	<div class="row mb-4">
		<div class="col-12">
			<button class="btn btn-secondary mb-3" @onclick="GoBack">
				<i class="fas fa-arrow-left"></i> @ECommerceResources.BackToCustomers
			</button>
		</div>
	</div>

	@if (IsLoading)
	{
		<div class="text-center">
			<div class="spinner-border text-primary" role="status">
				<span class="visually-hidden">@GeneralResources.Loading...</span>
			</div>
		</div>
	}
	else
	{
		<div class="row">
			<!-- Customer Profile Card -->
			<div class="col-lg-4">
				<div class="card shadow-sm mb-4">
					<div class="card-header bg-primary text-white">
						<h5 class="mb-0">@ECommerceResources.CustomerProfile</h5>
					</div>
					<div class="card-body">
						<div class="text-center mb-3">
							<i class="fas fa-user-circle text-primary" style="font-size: 4rem;"></i>
						</div>

						<h4 class="text-center mb-3">@Customer.FirstName @Customer.LastName</h4>

						<div class="mb-3">
							<label class="form-label fw-bold">@ECommerceResources.Status:</label>
							<span class="@GetStatusBadgeClass(CurrentUserStatus)">
								@GetStatusDisplayName(CurrentUserStatus)
							</span>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">@ECommerceResources.Email:</label>
							<p class="text-break">@Customer.Email</p>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">@ECommerceResources.LastLogin:</label>
							<p>@(Customer.LastLoginDate?.ToString("g") ?? @ECommerceResources.Never)</p>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">@ECommerceResources.WalletBalance:</label>
							<p class="text-success fw-bold">@Customer.WalletBalance.ToString("C")</p>
						</div>

						<div class="mb-3">
							<label class="form-label fw-bold">@ECommerceResources.TotalOrders:</label>
							<p>@Customer.OrderCount</p>
						</div>

						@if (!string.IsNullOrEmpty(Customer.Notes))
						{
							<div class="mb-3">
								<label class="form-label fw-bold">@ECommerceResources.Notes:</label>
								<p>@Customer.Notes</p>
							</div>
						}
					</div>
				</div>
			</div>

			<!-- Details Panel -->
			<div class="col-lg-8">
				<div class="card shadow-sm">
					<div class="card-header">
						<ul class="nav nav-tabs card-header-tabs" role="tablist">
							<li class="nav-item">
								<button class="nav-link @(ActiveTab == "orders" ? "active" : "")"
										type="button"
										@onclick="@(() => SetActiveTab("orders"))">
									<i class="fas fa-shopping-bag"></i> @ECommerceResources.OrderHistory
								</button>
							</li>
							<li class="nav-item">
								<button class="nav-link @(ActiveTab == "wallet" ? "active" : "")"
										type="button"
										@onclick="@(() => SetActiveTab("wallet"))">
									<i class="fas fa-wallet"></i> @ECommerceResources.WalletHistory
								</button>
							</li>
						</ul>
					</div>

					<div class="card-body">
						@if (ActiveTab == "orders")
						{
							<div class="tab-pane active">
								<h6 class="mb-3">@ECommerceResources.OrderHistory</h6>
								@if (OrderHistory.Any())
								{
									<div class="table-responsive">
										<table class="table table-striped table-hover">
											<thead class="table-light">
												<tr>
													<th>@ECommerceResources.OrderNumber</th>
													<th>@ECommerceResources.Date</th>
													<th>@ECommerceResources.Total</th>
													<th>@ECommerceResources.Status</th>
												</tr>
											</thead>
											<tbody>
												@foreach (var order in OrderHistory)
												{
													<tr>
														<td>@order.OrderNumber</td>
														<td>@order.OrderDate.ToString("g")</td>
														<td>@order.TotalAmount.ToString("C")</td>
														<td>
															<span class="badge bg-info">@order.Status</span>
														</td>
													</tr>
												}
											</tbody>
										</table>
									</div>
								}
								else
								{
									<div class="alert alert-info">
										<i class="fas fa-info-circle"></i> @ECommerceResources.NoOrdersFound
									</div>
								}
							</div>
						}
						@if (ActiveTab == "wallet")
						{
							<div class="tab-pane active">
								<h6 class="mb-3">@ECommerceResources.WalletHistory</h6>
								<div class="alert alert-primary">
									<strong>@ECommerceResources.CurrentBalance:</strong> @Customer.WalletBalance.ToString("C")
								</div>
								@if (WalletHistory.Any())
								{
									<div class="table-responsive">
										<table class="table table-striped table-hover">
											<thead class="table-light">
												<tr>
													<th>@ECommerceResources.Date</th>
													<th>@ECommerceResources.TransactionType</th>
													<th>@ECommerceResources.Amount</th>
													<th>@ECommerceResources.Fee</th>
													<th>@ECommerceResources.Status</th>
													<th>@ECommerceResources.AvailableBalance</th>
													<th>@ECommerceResources.PendingBalance</th>
												</tr>
											</thead>
											<tbody>
												@foreach (var transaction in WalletHistory)
												{
													<tr>
														<td>@transaction.CreatedDateLocalFormatted</td>
														<td>
															<span class="badge @GetTransactionTypeBadgeClass(transaction.TransactionType)">
																@transaction.TransactionType.ToString()
															</span>
														</td>
														<td class="@GetAmountClass(transaction.Amount)">
															@transaction.Amount.ToString("C")
														</td>
														<td>@transaction.FeeAmount.ToString("C")</td>
														<td>
															<span class="badge @GetTransactionStatusBadgeClass(transaction.TransactionStatus)">
																@transaction.TransactionStatus.ToString()
															</span>
														</td>
														<td class="text-success fw-bold">@transaction.AvailableBalanace.ToString("C")</td>
														<td class="text-warning">@transaction.PendingBalanace.ToString("C")</td>
													</tr>
												}
											</tbody>
										</table>
									</div>
								}
								else
								{
									<div class="alert alert-info">
										<i class="fas fa-info-circle"></i> @ECommerceResources.NoWalletTransactionsFound
									</div>
								}
							</div>
						}
					</div>
				</div>
			</div>
		</div>
	}
</div>

@code {
	// Component code is in Details.razor.cs
}
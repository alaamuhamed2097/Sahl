@page "/attributes"

@using Shared.DTOs.ECommerce.Category
@inherits BaseListPage<AttributeDto>
<PageTitle>@GeneralResources.Attributes</PageTitle>

<style>
    .cursor-pointer {
        cursor: pointer;
        user-select: none;
    }

    .cursor-pointer:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }
</style>

<div class="container-fluid p-0">
	<div class="card shadow-sm  border-0">
		<div class="card-header bg-primary text-white py-3 d-flex justify-content-between align-items-center">
			<h5 class="mb-0 fw-semibold text-white">🔖 @GeneralResources.Attributes</h5>
		</div>

		<div class="card-body p-4 ">
			<div class="dt-responsive  hide-scrollbar table-responsive">
				<!-- DESKTOP FILTRATION (Original - Unchanged) -->
				<ul class="navbar-nav d-flex flex-row align-items-center gap-3 mb-2 px-0 w-100 d-none d-lg-flex">
					<li class="nav-item gap-2 col-md-6 w-auto d-flex flex-row align-items-center gap-3">
						<EditForm Model="searchModel" OnSubmit="@Search">
							<!-- Search Box -->
							<div class="input-group rounded search-box">
								<input type="text" @bind="searchModel.SearchTerm"
									   id="searchInput"
									   class="form-control text-center border-0 @(ResourceManager.CurrentLanguage == Language.Arabic ? "rounded-end" : "rounded-start")"
									   placeholder="@ActionsResources.Search" />
								<button type="submit"
										class="btn btn-danger d-flex align-items-center justify-content-center border-0 @(ResourceManager.CurrentLanguage == Language.Arabic ? "rounded-start" : "rounded-end")">
									<i class="fas fa-search text-white m-0"></i>
								</button>
							</div>
						</EditForm>

						<!-- Page Size -->
						<div class="d-flex align-items-center gap-2">
							<select class="form-select rounded-3 shadow-sm border-light text-primary fw-bold text-center custom-dropdown"
									style="width: 130px; height: 40px; padding-right: 30px;"
									@onchange="OnPageSizeChanged">
								<option value="10" selected="@(searchModel.PageSize == 10)">10</option>
								<option value="15" selected="@(searchModel.PageSize == 15)">15</option>
								<option value="20" selected="@(searchModel.PageSize == 20)">20</option>
								<option value="30" selected="@(searchModel.PageSize == 30)">30</option>
							</select>
						</div>
					</li>
					<li class="nav-item ms-auto  d-flex flex-row align-items-center gap-2">
						<!-- Export Buttons -->
						<div class="dropdown">
							<button class="btn btn-info" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
								<i class="fas fa-file-export mx-1"></i>
								<span class="fw-bold">@ActionsResources.Export</span>
							</button>
							<ul class="dropdown-menu" aria-labelledby="exportDropdown">
								<li><a class="dropdown-item" href="javascript:void(0)" @onclick="ExportToExcel"><i class="far fa-file-excel mx-2"></i>Excel</a></li>
								<li><a class="dropdown-item" href="javascript:void(0)" @onclick="ExportToPrint"><i class="fas fa-print mx-2"></i>Print</a></li>
							</ul>
						</div>

						<!-- Add Button -->
						<button class="btn btn-success" @onclick="Add">
							<i class="feather icon-plus-circle mx-1"></i>
							<span class="fw-bold">@ActionsResources.Add</span>
						</button>
					</li>
				</ul>

				<!-- MOBILE FILTRATION (New Mobile-First Design) -->
				<!-- Table -->
				<!-- Responsive Table Container -->
				<div class="table-responsive dt-responsived  border rounded-3 overflow-hidden">
					<!-- DESKTOP TABLE (Original - Unchanged) -->
					<table class="table table-hover mb-0 d-none  d-lg-table">
						<thead class="bg-light">
							<tr>
								<th class="text-center p-3 align-middle cursor-pointer" @onclick='() => SortByColumn("Title")'>
									@ECommerceResources.Title
									<i class="@GetSortIconClass("Title") ms-1"></i>
								</th>
								<th class="text-center p-3 align-middle cursor-pointer" @onclick='() => SortByColumn("FieldType")'>
									@ECommerceResources.FieldType
									<i class="@GetSortIconClass("FieldType") ms-1"></i>
								</th>
								<th class="text-center p-3 align-middle" style="width: 200px;">@ECommerceResources.Actions</th>
							</tr>
						</thead>
						<tbody>
							@if (items != null)
							{
								@foreach (var item in items)
								{
									<tr class="align-middle">
										<td class="text-center p-3">@item.Title</td>
										<td class="text-center p-3">
											<span class="badge @GetFieldTypeBadgeClass(item.FieldType)">
												@GetFieldTypeDisplayName(item.FieldType)
											</span>
										</td>
										<td class="text-center p-3">
											<button class="btn btn-primary btn-sm " title="@ActionsResources.Edit" @onclick="() => Edit(item)">
												<i class="fas fa-pencil-alt mx-1 ms-2"></i>
												@ActionsResources.Edit
											</button>
											<button class="btn btn-danger btn-sm mx-1 ms-2" title="@ActionsResources.Delete" @onclick="() => Delete(item.Id)">
												<i class="feather icon-trash-2 mx-1 ms-2"></i>
												@ActionsResources.Delete
											</button>
										</td>
									</tr>
								}
							}
							else
							{
								<tr>
									<td colspan="7" class="no-data-container p-0">
										<div class=" d-flex flex-column justify-content-center align-items-center text-center" style="height: 52vh;">
											<!-- أيقونة كبيرة -->
											<i class="fas fa-database text-muted" style="font-size: 60px;"></i>

											<!-- نص -->
											<p class="text-muted mt-3" style="font-size: 18px;">
												@BrandResources.NoBrandsFound
											</p>
										</div>
									</td>

								</tr>
							}
						</tbody>
					</table>

					<!-- TABLET TABLE (New Condensed View for Medium Screens) -->
					<table class="table table-hover mb-0 d-none d-md-table d-lg-none">
						<thead class="bg-light">
							<tr>
								<th class="text-center p-2 align-middle small">@ECommerceResources.Title</th>
								<th class="text-center p-2 align-middle small">@ECommerceResources.FieldType</th>
								<th class="text-center p-2 align-middle small" style="width: 120px;">@ECommerceResources.Actions</th>
							</tr>
						</thead>
						<tbody>
							@if (items != null)
							{
								@foreach (var item in items)
								{
									<tr class="align-middle">
										<td class="text-center p-2 small">@item.Title</td>
										<td class="text-center p-2">
											<span class="badge @GetFieldTypeBadgeClass(item.FieldType) small">
												@GetFieldTypeDisplayName(item.FieldType)
											</span>
										</td>
										<td class="text-center p-2">
											<div class="btn-group btn-group-sm">
												<button class="btn btn-primary btn-sm" title="@ActionsResources.Edit" @onclick="() => Edit(item)">
													<i class="fas fa-pencil-alt m-0" style="font-size: 12px;"></i>
												</button>
												<button class="btn btn-danger btn-sm" title="@ActionsResources.Delete" @onclick="() => Delete(item.Id)">
													<i class="feather icon-trash-2 m-0" style="font-size: 12px;"></i>
												</button>
											</div>
										</td>
									</tr>
								}
							}
						</tbody>
					</table>

					<!-- MOBILE VIEW (New Enhanced Cards) -->
					<div class="d-md-none">
						@if (items != null)
						{
							@foreach (var item in items)
							{
								<div class="card mb-2 border-0 shadow-sm">
									<div class="card-body p-3">
										<!-- Header with Title and Actions -->
										<div class="d-flex justify-content-between align-items-start mb-2">
											<div class="flex-grow-1 me-2">
												<h6 class="mb-1 fw-bold text-primary">@item.Title</h6>
												<span class="badge @GetFieldTypeBadgeClass(item.FieldType) small">
													@GetFieldTypeDisplayName(item.FieldType)
												</span>
											</div>
											<div class="d-flex gap-1">
												<button class="btn btn-primary btn-sm" title="@ActionsResources.Edit" @onclick="() => Edit(item)">
													<i class="fas fa-pencil-alt m-0" style="font-size: 12px;"></i>
												</button>
												<button class="btn btn-danger btn-sm" title="@ActionsResources.Delete" @onclick="() => Delete(item.Id)">
													<i class="feather icon-trash-2 m-0" style="font-size: 12px;"></i>
												</button>
											</div>
										</div>

										<!-- Additional Details (if MaxLength exists) -->
										@if (!string.IsNullOrEmpty(item.MaxLength?.ToString()))
										{
											<div class="small text-muted">
												<strong>@ECommerceResources.MaxLength:</strong> @item.MaxLength
											</div>
										}
									</div>
								</div>
							}
						}
						else
						{
							<!-- Mobile Empty State -->
							<div class="text-center py-5">
								<i class="fas fa-inbox fa-3x text-muted mb-3"></i>
								<h5 class="text-muted">No Attributes Found</h5>
								<p class="text-muted mb-3">Get started by adding your first attribute</p>
								<button class="btn btn-success" @onclick="Add">
									<i class="feather icon-plus-circle me-2"></i>
									@ActionsResources.Add
								</button>
							</div>
						}
					</div>
				</div>

				<!-- MOBILE-OPTIMIZED PAGINATION (New) -->
				<div class="d-flex flex-column flex-sm-row justify-content-between align-items-center mt-3 gap-2" dir="ltr">
					<!-- Results Info -->
					<div class="text-center text-sm-start">
						<span class="text-muted small">
							@string.Format(
							ActionsResources.ShowingEntries,
														((currentPage - 1) * searchModel.PageSize + 1),
														Math.Min(currentPage * searchModel.PageSize, totalRecords),
														totalRecords
														)
						</span>
					</div>

					<!-- Pagination Controls -->
					<nav>
						<ul class="pagination mb-0 pagination-sm">
							<!-- First Button -->
							<li class="page-item @(currentPage == 1 ? "disabled" : "") d-none d-sm-inline-block">
								<a class="page-link" href="javascript:void(0)" @onclick="() => GoToPage(1)" title="@ActionsResources.First">
									<i class="fas fa-angle-double-left"></i>
								</a>
							</li>

							<!-- Previous Button -->
							<li class="page-item @(currentPage == 1 ? "disabled" : "")">
								<a class="page-link" href="javascript:void(0)" @onclick="() => GoToPage(currentPage - 1)">
									<span class="d-none d-sm-inline">@ActionsResources.Previous</span>
									<span class="d-sm-none"><i class="fas fa-chevron-left"></i></span>
								</a>
							</li>

							<!-- Dynamic Page Numbers -->
							@{
														int maxVisiblePages = 3; // يناسب الموبايل
							int startPage = Math.Max(1, currentPage - 1);
							int endPage = Math.Min(totalPages, startPage + maxVisiblePages - 1);

							if (endPage - startPage + 1 < maxVisiblePages)
							{
								startPage = Math.Max(1, endPage - maxVisiblePages + 1);
							}
														}

							@if (startPage > 1)
							{
								<li class="page-item disabled d-none d-sm-inline-block">
									<a class="page-link">...</a>
								</li>
							}

							@for (int pag = startPage; pag <= endPage; pag++)
							{
								int pageNumber = pag;
								<li class="page-item @(pag == currentPage ? "active" : "")">
									<a class="page-link" href="javascript:void(0)" @onclick="() => GoToPage(pageNumber)">
										@pag
									</a>
								</li>
							}

							@if (endPage < totalPages)
							{
								<li class="page-item disabled d-none d-sm-inline-block">
									<a class="page-link">...</a>
								</li>
							}

							<!-- Next Button -->
							<li class="page-item @(currentPage == totalPages ? "disabled" : "")">
								<a class="page-link" href="javascript:void(0)" @onclick="() => GoToPage(currentPage + 1)">
									<span class="d-none d-sm-inline">@ActionsResources.Next</span>
									<span class="d-sm-none"><i class="fas fa-chevron-right"></i></span>
								</a>
							</li>

							<!-- Last Button -->
							<li class="page-item @(currentPage == totalPages ? "disabled" : "") d-none d-sm-inline-block">
								<a class="page-link" href="javascript:void(0)" @onclick="() => GoToPage(totalPages)" title="@ActionsResources.Last">
									<i class="fas fa-angle-double-right"></i>
								</a>
							</li>
						</ul>
					</nav>
				</div>

				<!-- Pagination end -->
			</div>
		</div>
	</div>
</div>
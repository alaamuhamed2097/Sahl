@page "/brands"

@using Common.Enumerations
@using Common.Enumerations.User
@using Resources
@using Resources.Enumerations
@using Shared.DTOs.Brand
@attribute [Authorize(Roles = nameof(UserRole.Admin))]
@inherits BaseListPage<BrandDto>

<PageTitle>@BrandResources.BrandManagement</PageTitle>

<div class="container-fluid p-0">
	<div class="card shadow-sm border-0">
		<div class="card-header bg-primary text-white py-3 d-flex justify-content-between align-items-center">
			<h5 class="mb-0 fw-semibold text-white">🏷️ @BrandResources.BrandManagement</h5>
		</div>
		<div class="card-body mobil-stylest ">
			<div class="dt-responsive table-responsive ">
				<!-- Filtration start -->
				<ul class="navbar-nav d-flex flex-row align-items-center gap-3 mb-2 px-0 w-100">
					<li class="nav-item col-md-6 w-auto d-flex flex-row align-items-center gap-3">
						<EditForm Model="searchModel" OnSubmit="@Search">
							<!-- Search Box -->
							<div class="search-container">
								<div class="input-group search-box">
									<input type="text"
										   @bind="searchModel.SearchTerm"
										   id="searchInput"
										   class="form-control search-input"
										   placeholder="@ActionsResources.Search" />
									<button type="submit"
											class="btn btn-search">
										<i class="fas fa-search"></i>
									</button>
								</div>
							</div>
						</EditForm>
						<!-- Page Size -->
						<div class="d-flex align-items-center gap-2">
							<select class="form-select rounded-3 shadow-sm border-light text-primary fw-bold text-center custom-dropdown"
									style="width: 130px; height: 40px; padding-right: 30px;"
									@onchange="OnPageSizeChanged">
								<option value="10" selected="@(searchModel.PageSize == 10)">10</option>
								<option value="15" selected="@(searchModel.PageSize == 15)">15</option>
								<option value="20" selected="@(searchModel.PageSize == 20)">20</option>
								<option value="30" selected="@(searchModel.PageSize == 30)">30</option>
							</select>
						</div>



						<!-- Filter -->
						<div class="d-flex align-items-center gap-2">
							<!-- <label class="form-label hidden fw-semibold mb-0">@ActionsResources.Filter</label> -->
							<select class="form-select rounded-3 shadow-sm border-light text-primary fw-bold text-center custom-dropdown"
									style="width: 200px; height: 40px; padding-right: 30px;"
									@onchange="OnFilterChanged">
								<option value="">@BrandResources.AllBrands</option>
								<option value="favorites">@BrandResources.FavoriteBrands</option>
								<option value="withWebsite">@BrandResources.BrandsWithWebsite</option>
								<option value="recent">@BrandResources.RecentBrands</option>
							</select>
						</div>

					</li>
					<li class="nav-item ms-auto d-flex flex-row align-items-center gap-2">
						<!-- Export Buttons -->
						<div class="dropdown">
							<button class="btn btn-info" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
								<i class="fas fa-file-export mx-1"></i>
								<span class="fw-bold">@ActionsResources.Export</span>
							</button>
							<ul class="dropdown-menu" aria-labelledby="exportDropdown">
								<li><a class="dropdown-item" href="javascript:void(0)" @onclick="ExportToExcel"><i class="far fa-file-excel mx-1"></i>Excel</a></li>
								<li><a class="dropdown-item" href="javascript:void(0)" @onclick="ExportToPrint"><i class="fas fa-print mx-1"></i>Print</a></li>
							</ul>
						</div>
						<!-- Add Brand Button -->
						<button class="btn btn-success" @onclick="Add">
							<i class="feather icon-plus-circle "></i>
							<span class="fw-bold">@ActionsResources.Add</span>
						</button>

					</li>
				</ul>
				<div class="d-none d-md-block">
					<!-- Table -->
					<div class="table-responsive dt-responsived table-container border rounded-3">
						<table id="brand-table" class="table table-striped table-hover mb-0 align-text-center">
							<thead class="bg-light">
								<tr>
									<th class="text-center align-middle">#</th>
									<th class="text-center align-middle">@BrandResources.BrandLogo</th>
									<th class="text-center align-middle">@BrandResources.BrandName</th>
									<th class="text-center align-middle">@BrandResources.WebsiteUrl</th>
									<th class="text-center align-middle">@GeneralResources.DisplayOrder</th>
									<th class="text-center align-middle">@ECommerceResources.Actions</th>
								</tr>
							</thead>
							<tbody>
								@if (items != null && items.Any())
								{
									int i = (currentPage - 1) * searchModel.PageSize;
									@foreach (var item in items)
									{
										<tr>
											<td class="text-center align-middle">@(++i)</td>
											<td class="text-center align-middle">
												@if (!string.IsNullOrEmpty(item.LogoPath))
												{
													<img src="@baseUrl/@item.LogoPath" alt="@item.Name" class="rounded" style="width: 40px; height: 40px; object-fit: cover;" />
												}
												else
												{
													<div class="bg-secondary rounded d-flex align-items-center justify-content-center text-white" style="width: 40px; height: 40px;">
														<i class="fas fa-image"></i>
													</div>
												}
											</td>
											<td class="text-center align-middle">
												<strong>@item.Name</strong>
											</td>
											<td class="text-center align-middle">
												@if (!string.IsNullOrEmpty(item.WebsiteUrl))
												{
													<a href="@item.WebsiteUrl" target="_blank" class="btn btn-link btn-sm">
														<i class="fas fa-external-link-alt"></i>
													</a>
												}
												else
												{
													<span class="text-muted">-</span>
												}
											</td>
											<td class="text-center align-middle">
												<span class="badge bg-info">@item.DisplayOrder</span>
											</td>
											<td class="d-flex gap-1 justify-content-center align-items-center">
												<button class="btn btn-primary btn-sm mx-1 d-flex align-items-center"
														@onclick="() => Edit(item)" title="@ActionsResources.Edit">
													<i class="feather icon-edit me-2"></i>
													<span>@ActionsResources.Edit</span>
												</button>

												<button class="btn btn-danger btn-sm mx-1 d-flex align-items-center"
														@onclick="() => Delete(item.Id)" title="@ActionsResources.Delete">
													<i class="feather icon-trash-2 me-2"></i>
													<span>@ActionsResources.Delete</span>
												</button>

											</td>
										</tr>
									}
								}
								else
								{
									<tr>
										<td colspan="7" class="no-data-container p-0">
											<div class=" d-flex flex-column justify-content-center align-items-center text-center" style="height: 52vh;">
												<!-- أيقونة كبيرة -->
												<i class="fas fa-database text-muted" style="font-size: 60px;"></i>

												<!-- نص -->
												<p class="text-muted mt-3" style="font-size: 18px;">
													@BrandResources.NoBrandsFound
												</p>
											</div>
										</td>

									</tr>
								}
							</tbody>
						</table>
					</div>
				</div>
				<!-- MOBILE CARDS (Visible only on Mobile) -->
				<div class="d-block d-md-none mt-3">

					@if (items != null && items.Any())
					{
						foreach (var item in items)
						{
							<div class="card shadow-sm mb-3 border-0">
								<div class="card-body">

									<!-- Brand Image + Name -->
									<div class="d-flex align-items-center gap-3">
										@if (!string.IsNullOrEmpty(item.LogoPath))
										{
											<img src="@baseUrl/@item.LogoPath"
												 class="rounded"
												 style="width: 55px; height: 55px; object-fit: cover;" />
										}
										else
										{
											<div class="bg-secondary rounded d-flex align-items-center justify-content-center text-white"
												 style="width: 55px; height: 55px;">
												<i class="fas fa-image"></i>
											</div>
										}

										<div class="flex-grow-1">
											<h5 class="fw-bold mb-1">@item.Name</h5>
											<span class="badge bg-secondary">Name: @item.Name</span>
										</div>
									</div>

									<hr />

									<!-- Website -->
									<p class="mb-2">
										<i class="fas fa-globe text-primary me-2"></i>
										@if (!string.IsNullOrEmpty(item.WebsiteUrl))
										{
											<a href="@item.WebsiteUrl" target="_blank">@item.WebsiteUrl</a>
										}
										else
										{
											<span class="text-muted">---</span>
										}
									</p>

									<!-- Display Order -->
									<p class="mb-2">
										<i class="fas fa-sort-numeric-up text-info me-2"></i>
										@GeneralResources.DisplayOrder:
										<b>@item.DisplayOrder</b>
									</p>

									<hr />

									<!-- Actions -->
									<div class="d-flex justify-content-between gap-2">

										<button class="btn btn-primary w-100"
												@onclick="() => Edit(item)">
											<i class="feather icon-edit me-1"></i>
											@ActionsResources.Edit
										</button>

										<button class="btn btn-danger w-100"
												@onclick="() => Delete(item.Id)">
											<i class="feather icon-trash me-1"></i>
											@ActionsResources.Delete
										</button>

									</div>

								</div>
							</div>
						}
					}
					else
					{
						<div class="text-center p-4">
							<i class="fas fa-database text-muted" style="font-size: 50px;"></i>
							<p class="text-muted mt-3">@BrandResources.NoBrandsFound</p>
						</div>
					}

				</div>

				<!-- Pagination -->
				<div class="pagination-wrapper d-flex flex-column justify-content-end flex-grow-1">
					<div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mt-4 pagination-container" dir="ltr">

						<!-- النص الإحصائي -->
						<div class="text-muted small">
							@string.Format(ActionsResources.ShowingEntries, StartRecord, EndRecord, totalRecords)
						</div>

						<!-- الباجينيشن -->
						<nav aria-label="Pagination">
							<ul class="pagination pagination-sm mb-0 shadow-sm rounded-3 overflow-hidden">

								<!-- أول صفحة -->
								<li class="page-item @(!CanGoToPreviousPage ? "disabled" : "")">
									<a class="page-link" @onclick="() => GoToPage(1)" title="@ActionsResources.First">
										<i class="fas fa-angle-double-left"></i>
									</a>
								</li>

								<!-- السابقة -->
								<li class="page-item @(!CanGoToPreviousPage ? "disabled" : "")">
									<a class="page-link" @onclick="() => GoToPage(currentPage - 1)">
										<i class="fas fa-angle-left"></i>
									</a>
								</li>

								@* أرقام الصفحات *@
								@{
									const int maxVisiblePages = 5;
									int startPage = Math.Max(1, currentPage - 2);
									int endPage = Math.Min(totalPages, startPage + maxVisiblePages - 1);
									if (endPage - startPage + 1 < maxVisiblePages)
									{
										startPage = Math.Max(1, endPage - maxVisiblePages + 1);
									}
								}

								@if (startPage > 1)
								{
									<li class="page-item disabled"><span class="page-link">...</span></li>
								}

								@for (int pag = startPage; pag <= endPage; pag++)
								{
									int pageNumber = pag;
									<li class="page-item @(pag == currentPage ? "active" : "")">
										<a class="page-link fw-bold" @onclick="() => GoToPage(pageNumber)">@pag</a>
									</li>
								}

								@if (endPage < totalPages)
								{
									<li class="page-item disabled"><span class="page-link">...</span></li>
								}

								<!-- التالية -->
								<li class="page-item @(!CanGoToNextPage ? "disabled" : "")">
									<a class="page-link" @onclick="() => GoToPage(currentPage + 1)">
										<i class="fas fa-angle-right"></i>
									</a>
								</li>

								<!-- آخر صفحة -->
								<li class="page-item @(!CanGoToNextPage ? "disabled" : "")">
									<a class="page-link" @onclick="() => GoToPage(totalPages)" title="@ActionsResources.Last">
										<i class="fas fa-angle-double-right"></i>
									</a>
								</li>

							</ul>
						</nav>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>
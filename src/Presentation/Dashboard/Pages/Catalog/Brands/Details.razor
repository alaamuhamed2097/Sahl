@page "/brand"
@page "/brand/{id:guid}"
@inherits LocalizedComponentBase

@using Common.Enumerations.User
@attribute [Authorize(Roles = nameof(UserRole.Admin))]

<PageTitle>@BrandResources.AddBrand</PageTitle>

<div class="container-fluid p-0">
    <div class="card shadow-sm  border-0">
        <div class="card-header d-flex justify-content-between bg-primary align-items-center">
            <h4 class="modal-title text-white">
                @(Model.Id == Guid.Empty ? $"➕ {ActionsResources.Add}" : $"✏️ {ActionsResources.Edit}") @BrandResources.Brand
            </h4>
        </div>
        <EditForm Model="@Model" OnValidSubmit="Save">
            <DataAnnotationsValidator />
            
            <div class="card-body p-4">
                <!-- Name Fields -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@FormResources.NameAr:</label>
                        <InputText class="form-control" @bind-Value="Model.NameAr"
                                   placeholder="@String.Format(FormResources.Placeholder, FormResources.NameAr)" />
                        <ValidationMessage For="@(() => Model.NameAr)" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@FormResources.NameEn:</label>
                        <InputText class="form-control" @bind-Value="Model.NameEn"
                                   placeholder="@String.Format(FormResources.Placeholder, FormResources.NameEn)" />
                        <ValidationMessage For="@(() => Model.NameEn)" />
                    </div>
                </div>

                <!-- Title Fields -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@BrandResources.TitleAr:</label>
                        <InputText class="form-control" @bind-Value="Model.TitleAr"
                                   placeholder="@String.Format(FormResources.Placeholder, BrandResources.TitleAr)" />
                        <ValidationMessage For="@(() => Model.TitleAr)" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@BrandResources.TitleEn:</label>
                        <InputText class="form-control" @bind-Value="Model.TitleEn"
                                   placeholder="@String.Format(FormResources.Placeholder, BrandResources.TitleEn)" />
                        <ValidationMessage For="@(() => Model.TitleEn)" />
                    </div>
                </div>

                <!-- Description Fields -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@BrandResources.DescriptionAr:</label>
                        <InputTextArea class="form-control" @bind-Value="Model.DescriptionAr" rows="3"
                                       placeholder="@String.Format(FormResources.Placeholder, BrandResources.DescriptionAr)" />
                        <ValidationMessage For="@(() => Model.DescriptionAr)" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@BrandResources.DescriptionEn:</label>
                        <InputTextArea class="form-control" @bind-Value="Model.DescriptionEn" rows="3"
                                       placeholder="@String.Format(FormResources.Placeholder, BrandResources.DescriptionEn)" />
                        <ValidationMessage For="@(() => Model.DescriptionEn)" />
                    </div>
                </div>

                <!-- Website URL, Display Order, and Favorite -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">@BrandResources.WebsiteUrl:</label>
                        <InputText class="form-control" @bind-Value="Model.WebsiteUrl"
                                   placeholder="@BrandResources.WebsiteUrlPlaceholder" />
                        <ValidationMessage For="@(() => Model.WebsiteUrl)" />
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">@BrandResources.DisplayOrder:</label>
                        <InputNumber class="form-control" @bind-Value="Model.DisplayOrder" />
                        <ValidationMessage For="@(() => Model.DisplayOrder)" />
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="form-check mt-4">
                            <InputCheckbox class="form-check-input" @bind-Value="Model.IsFavorite" />
                            <label class="form-check-label">@BrandResources.MarkAsFavorite</label>
                        </div>
                    </div>
                </div>

                <!-- Logo Upload -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">@FormResources.Logo:</label>
                        <InputFile class="form-control"
                                   OnChange="HandleSelectedLogo"
                                   accept="image/*" />
                        <ValidationMessage For="@(() => Model.Base64Image)" />
                        <small class="form-text text-muted">
                            @ValidationResources.AllowedFormats: JPG, JPEG, PNG, WEBP (@ValidationResources.MaxSize: 5MB)
                        </small>

                        @if (!string.IsNullOrEmpty(previewLogoUrl))
                        {
                            <div class="position-relative d-inline-block mt-3">
                                <img src="@previewLogoUrl" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" alt="Preview" />
                                <button type="button" class="btn-close position-absolute top-0 end-0 m-1"
                                        style="background-color: rgba(255,255,255,0.8); border-radius: 50%;"
                                        @onclick="RemoveSelectedImage" title="@ActionsResources.Remove"></button>
                            </div>
                        }
                        else if (!string.IsNullOrEmpty(Model.LogoPath))
                        {
                            <div class="mt-3">
                                <p class="text-muted small">@FormResources.Logo:</p>
                                <img src="@baseUrl/@Model.LogoPath" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" alt="Current Logo" />
                            </div>
                        }
                    </div>
                </div>

                <!-- Show creation date for existing records -->
                @if (Model.Id != Guid.Empty && Model.CreatedDateUtc.HasValue)
                {
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">@FormResources.CreationDate:</label>
                            <input type="text" class="form-control" readonly
                                   value="@Model.CreatedDateLocalFormatted" />
                        </div>
                    </div>
                }

            </div>
            <div class="card-footer bg-light py-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary " @onclick="CloseModal">
                    <i class="fas fa-times me-2 ms-2" ></i>@ActionsResources.Cancel
                </button>
                <button type="submit" class="btn btn-primary " disabled="@isSaving">
                    @if (isSaving)
                    {
                        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        <span>@FormResources.Saving...</span>
                    }
                    else
                    {
                        <i class="fas fa-save me-2 ms-2"></i>

                        @ActionsResources.Save
                    }
                </button>
            </div>
        </EditForm>
    </div>
</div>
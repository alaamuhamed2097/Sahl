(function(n){"use strict";function tr(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var u=Array(i),f=0,n=0;n<r;n++)for(var e=arguments[n],t=0,o=e.length;t<o;t++,f++)u[f]=e[t];return u}function wf(){nr.add("textpattern",function(n){var t=ct(eu(n.settings));return pf.setup(n,t),ru.get(t)})}var ct=function(n){var t=n,i=function(){return t},r=function(n){t=n},u=function(){return ct(i())};return{get:i,set:r,clone:u}},nr=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=function(){return o=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},o.apply(this,arguments)},lt=function(){},i=function(n){return function(){return n}},ir=function(n){return n},rr=function(n){return function(){throw new Error(n);}},r=i(!1),s=i(!0),w=function(){return rt},rt=function(){var n=function(n){return n.isNone()},t=function(n){return n()},u=function(n){return n},f={fold:function(n){return n()},is:r,isSome:r,isNone:s,getOr:u,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.");},getOrNull:i(null),getOrUndefined:i(undefined),or:u,orThunk:t,map:w,each:lt,bind:w,exists:r,forall:s,filter:w,equals:n,equals_:n,toArray:function(){return[]},toString:i("none()")};return Object.freeze&&Object.freeze(f),f}(),ut=function(n){var t=i(n),e=function(){return f},u=function(t){return t(n)},f={fold:function(t,i){return i(n)},is:function(t){return n===t},isSome:s,isNone:r,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return ut(t(n))},each:function(t){t(n)},bind:u,exists:u,forall:u,filter:function(t){return t(n)?f:rt},toArray:function(){return[n]},toString:function(){return"some("+n+")"},equals:function(t){return t.is(n)},equals_:function(t,i){return t.fold(r,function(t){return i(n,t)})}};return f},ur=function(n){return n===null||n===undefined?rt:ut(n)},t={some:ut,none:w,from:ur},fr=function(n){if(n===null)return"null";var t=typeof n;return t==="object"&&(Array.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="Array")?"array":t==="object"&&(String.prototype.isPrototypeOf(n)||n.constructor&&n.constructor.name==="String")?"string":t},b=function(n){return function(t){return fr(t)===n}},h=b("string"),er=b("object"),a=b("array"),or=b("function"),at=Array.prototype.slice,sr=Array.prototype.indexOf,hr=function(n,t){return sr.call(n,t)},vt=function(n,t){return hr(n,t)>-1},k=function(n,t){for(var f,r=n.length,u=new Array(r),i=0;i<r;i++)f=n[i],u[i]=t(f,i);return u},e=function(n,t){for(var u,i=0,r=n.length;i<r;i++)u=n[i],t(u,i)},cr=function(n,t){for(var r,i=n.length-1;i>=0;i--)r=n[i],t(r,i)},yt=function(n,t){for(var r,u=[],i=0,f=n.length;i<f;i++)r=n[i],t(r,i)&&u.push(r);return u},pt=function(n,t,i){return cr(n,function(n){i=t(i,n)}),i},lr=function(n,t,i){return e(n,function(n){i=t(i,n)}),i},ar=function(n,i){for(var u,r=0,f=n.length;r<f;r++)if(u=n[r],i(u,r))return t.some(u);return t.none()},wt=function(n,t){for(var u,i=0,r=n.length;i<r;++i)if(u=n[i],t(u,i)!==!0)return!1;return!0},vr=function(n,t){var i=at.call(n,0);return i.sort(t),i},yr=function(n){return n.length===0?t.none():t.some(n[0])},bf=or(Array.from)?Array.from:function(n){return at.call(n)},bt=Object.keys,pr=Object.hasOwnProperty,wr=function(n,i){return kt(n,i)?t.from(n[i]):t.none()},kt=function(n,t){return pr.call(n,t)},br=function(t){if(!a(t))throw new Error("cases must be an array");if(t.length===0)throw new Error("there must be at least one case");var i=[],r={};return e(t,function(u,f){var s=bt(u),e,o;if(s.length!==1)throw new Error("one and only one name per case");if(e=s[0],o=u[e],r[e]!==undefined)throw new Error("duplicate key detected:"+e);else if(e==="cata")throw new Error("cannot have a case named cata (sorry)");else if(!a(o))throw new Error("case arguments must be an array");i.push(e);r[e]=function(){var s=arguments.length,r,u,h;if(s!==o.length)throw new Error("Wrong number of arguments to case "+e+". Expected "+o.length+" ("+o+"), got "+s);for(r=new Array(s),u=0;u<r.length;u++)r[u]=arguments[u];return h=function(n){var t=bt(n),u;if(i.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+i.join(",")+"\nActual: "+t.join(","));if(u=wt(i,function(n){return vt(t,n)}),!u)throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+i.join(", "));return n[e].apply(null,r)},{fold:function(){if(arguments.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+arguments.length);var n=arguments[f];return n.apply(null,r)},match:h,log:function(t){n.console.log(t,{constructors:i,constructor:e,params:r})}}}}),r},kr={generate:br},kf=kr.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),dt=function(n){var t=[],i=[];return e(n,function(n){n.fold(function(n){t.push(n)},function(n){i.push(n)})}),{errors:t,values:i}},c=function(n){var u=function(t){return n===t},f=function(){return c(n)},e=function(){return c(n)},o=function(t){return c(t(n))},h=function(){return c(n)},l=function(t){t(n)},a=function(t){return t(n)},v=function(t,i){return i(n)},y=function(t){return t(n)},p=function(t){return t(n)},w=function(){return t.some(n)};return{is:u,isValue:s,isError:r,getOr:i(n),getOrThunk:i(n),getOrDie:i(n),or:f,orThunk:e,fold:v,map:o,mapError:h,each:l,bind:a,exists:y,forall:p,toOption:w}},v=function(n){var i=function(n){return n()},u=function(){return rr(String(n))()},f=function(n){return n},e=function(n){return n()},o=function(){return v(n)},h=function(t){return v(t(n))},c=function(){return v(n)},l=function(t){return t(n)};return{is:r,isValue:r,isError:s,getOr:ir,getOrThunk:i,getOrDie:u,or:f,orThunk:e,fold:l,map:o,mapError:h,each:lt,bind:c,exists:r,forall:s,toOption:t.none}},dr=function(n,t){return n.fold(function(){return v(t)},c)},d={value:c,error:v,fromOption:dr},gr=function(n){return n.type==="inline-command"||n.type==="inline-format"},nu=function(n){return n.type==="block-command"||n.type==="block-format"},tu=function(n){return vr(n,function(n,t){return n.start.length===t.start.length?0:n.start.length>t.start.length?-1:1})},gt=function(n){var t=function(t){return d.error({message:t,pattern:n})},u=function(i,r,u){if(n.format!==undefined){var f=void 0;if(a(n.format)){if(!wt(n.format,h))return t(i+" pattern has non-string items in the `format` array");f=n.format}else if(h(n.format))f=[n.format];else return t(i+" pattern has non-string `format` parameter");return d.value(r(f))}return n.cmd!==undefined?h(n.cmd)?d.value(u(n.cmd,n.value)):t(i+" pattern has non-string `cmd` parameter"):t(i+" pattern is missing both `format` and `cmd` parameters")},i,r;return er(n)?h(n.start)?n.end!==undefined?h(n.end)?n.start.length===0&&n.end.length===0?t("Inline pattern has empty `start` and `end` parameters"):(i=n.start,r=n.end,r.length===0&&(r=i,i=""),u("Inline",function(n){return{type:"inline-format",start:i,end:r,format:n}},function(n,t){return{type:"inline-command",start:i,end:r,cmd:n,value:t}})):t("Inline pattern has non-string `end` parameter"):n.replacement!==undefined?h(n.replacement)?n.start.length===0?t("Replacement pattern has empty `start` parameter"):d.value({type:"inline-command",start:"",end:n.start,cmd:"mceInsertContent",value:n.replacement}):t("Replacement pattern has non-string `replacement` parameter"):n.start.length===0?t("Block pattern has empty `start` parameter"):u("Block",function(t){return{type:"block-format",start:n.start,format:t[0]}},function(t,i){return{type:"block-command",start:n.start,cmd:t,value:i}}):t("Raw pattern is missing `start` parameter"):t("Raw pattern is not an object")},ni=function(n){return n.type==="block-command"?{start:n.start,cmd:n.cmd,value:n.value}:n.type==="block-format"?{start:n.start,format:n.format}:n.type==="inline-command"?n.cmd==="mceInsertContent"&&n.start===""?{start:n.end,replacement:n.value}:{start:n.start,end:n.end,cmd:n.cmd,value:n.value}:n.type==="inline-format"?{start:n.start,end:n.end,format:n.format.length===1?n.format[0]:n.format}:void 0},ti=function(n){return{inlinePatterns:yt(n,gr),blockPatterns:tu(yt(n,nu))}},iu=function(n){var t=function(t){var i=dt(k(t,gt)),r;if(i.errors.length>0){r=i.errors[0];throw new Error(r.message+":\n"+JSON.stringify(r.pattern,null,2));}n.set(ti(i.values))},i=function(){return tr(k(n.get().inlinePatterns,ni),k(n.get().blockPatterns,ni))};return{setPatterns:t,getPatterns:i}},ru={get:iu},uu=typeof n.window!="undefined"?n.window:Function("return this;")(),ii=function(){for(var n,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];n=uu.console;n&&(n.error?n.error.apply(n,i):n.log.apply(n,i))},fu=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],eu=function(n){var i=wr(n,"textpattern_patterns").getOr(fu),t;return a(i)?(t=dt(k(i,gt)),e(t.errors,function(n){return ii(n.message,n.pattern)}),ti(t.values)):(ii("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]})},ri=function(n){var t=n.getParam("forced_root_block","p");return t===!1?"":t===!0?"p":t},ou=tinymce.util.Tools.resolve("tinymce.util.Delay"),ui=tinymce.util.Tools.resolve("tinymce.util.VK"),fi="﻿",su=" ",hu=tinymce.util.Tools.resolve("tinymce.util.Tools"),cu=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),y=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),u=function(n,t){return{container:n,offset:t}},f=function(t){return t.nodeType===n.Node.TEXT_NODE},l=function(n,t,i){if(t&&n.isEmpty(t)&&!i(t)){var r=t.parentNode;n.remove(t);l(n,r,i)}},g=function(n,t,i,r){r===void 0&&(r=!0);var u=t.startContainer.parentNode,e=t.endContainer.parentNode;t.deleteContents();r&&!i(t.startContainer)&&(f(t.startContainer)&&t.startContainer.data.length===0&&n.remove(t.startContainer),f(t.endContainer)&&t.endContainer.data.length===0&&n.remove(t.endContainer),l(n,u,i),u!==e&&l(n,e,i))},lu=function(n,t){var i=t.get(n);return a(i)&&yr(i).exists(function(n){return kt(n,"block")})},ft=function(n){return n.start.length===0},et=function(n,i){var r=t.from(n.dom.getParent(i.startContainer,n.dom.isBlock));return ri(n)===""?r.orThunk(function(){return t.some(n.getBody())}):r},nt=cu.DOM,tt=function(n){return function(t){return n===t?-1:0}},au=function(n){return function(t){return n.isBlock(t)||vt(["BR","IMG","HR","INPUT"],t.nodeName)||n.getContentEditable(t)==="false"}},ot=function(n,i,r){if(f(n)&&i>=0)return t.some(u(n,i));var e=y(nt);return t.from(e.backwards(n,i,tt(n),r)).map(function(n){return u(n.container,n.container.data.length)})},vu=function(n,i,r){if(f(n)&&i>=n.length)return t.some(u(n,i));var e=y(nt);return t.from(e.forwards(n,i,tt(n),r)).map(function(n){return u(n.container,0)})},st=function(n,i,r){var e,o;return f(n)?(e=n.textContent,i>=0&&i<=e.length?t.some(u(n,i)):(o=y(nt),t.from(o.backwards(n,i,tt(n),r)).bind(function(n){var t=n.container.data;return st(n.container,i+t.length,r)}))):t.none()},ei=function(n,i,r){var e,o;return f(n)?(e=n.textContent,i<=e.length?t.some(u(n,i)):(o=y(nt),t.from(o.forwards(n,i,tt(n),r)).bind(function(n){return ei(n.container,i-e.length,r)}))):t.none()},yu=function(n,i,r,u,f){var e=y(n,au(n));return t.from(e.backwards(i,r,u,f))},oi=function(n,t,i){var o,r,e,u;if(f(t)&&(i<0||i>t.data.length))return[];for(o=[i],r=t;r!==n&&r.parentNode;){for(e=r.parentNode,u=0;u<e.childNodes.length;u++)if(e.childNodes[u]===r){o.push(u);break}r=e}return r===n?o.reverse():[]},ht=function(n,t,i,r,u){var f=oi(n,t,i),e=oi(n,r,u);return{start:f,end:e}},si=function(n,i){var u=i.slice(),r=u.pop();return lr(u,function(n,i){return n.bind(function(n){return t.from(n.childNodes[i])})},t.some(n)).bind(function(n){return f(n)&&r>=0&&r<=n.data.length?t.some({node:n,offset:r}):t.some({node:n,offset:r})})},hi=function(t,i){return si(t,i.start).bind(function(r){var u=r.node,f=r.offset;return si(t,i.end).map(function(t){var r=t.node,e=t.offset,i=n.document.createRange();return i.setStart(u,f),i.setEnd(r,e),i})})},pu=function(n,t){return ht(n,t.startContainer,t.startOffset,t.endContainer,t.endOffset)},ci=function(n,t,i){var r=vu(t,0,t);r.each(function(r){var u=r.container;ei(u,i.start.length,t).each(function(i){var r=n.createRng();r.setStart(u,0);r.setEnd(i.container,i.offset);g(n,r,function(n){return n===t})})})},wu=function(n,t){var r=n.dom,i=t.pattern,u=hi(r.getRoot(),t.range).getOrDie("Unable to resolve path range");return et(n,u).each(function(t){i.type==="block-format"?lu(i.format,n.formatter)&&n.undoManager.transact(function(){ci(n.dom,t,i);n.formatter.apply(i.format)}):i.type==="block-command"&&n.undoManager.transact(function(){ci(n.dom,t,i);n.execCommand(i.cmd,!1,i.value)})}),!0},bu=function(n,t){var i=t.replace(su," ");return ar(n,function(n){return t.indexOf(n.start)!==0&&i.indexOf(n.start)!==0?!1:!0})},ku=function(n,t){var i=n.dom,r=n.selection.getRng();return et(n,r).filter(function(t){var r=ri(n),u=r===""&&i.is(t,"body")||i.is(t,r);return t!==null&&u}).bind(function(n){var r=n.textContent,u=bu(t,r);return u.map(function(t){return hu.trim(r).length===t.start.length?[]:[{pattern:t,range:ht(i.getRoot(),n,0,n,0)}]})}).getOr([])},du=function(n,t){if(t.length!==0){var i=n.selection.getBookmark();e(t,function(t){return wu(n,t)});n.selection.moveToBookmark(i)}},li=0,gu=function(n){var t=new Date,i=t.getTime(),r=Math.floor(Math.random()*1e9);return li++,n+"_"+r+li+String(i)},nf=function(n,t,i){if(t==="")return!0;if(n.length<t.length)return!1;var r=n.substr(i,i+t.length);return r===t},tf=function(n,t){return nf(n,t,n.length-t.length)},ai=function(n,t){return n.create("span",{"data-mce-type":"bookmark",id:t})},it=function(n,t){var i=n.createRng();return i.setStartAfter(t.start),i.setEndBefore(t.end),i},vi=function(n,t,i){var r=hi(n.getRoot(),i).getOrDie("Unable to resolve path range"),u=r.startContainer,f=r.endContainer,e=r.endOffset===0?f:f.splitText(r.endOffset),o=r.startOffset===0?u:u.splitText(r.startOffset);return{prefix:t,end:e.parentNode.insertBefore(ai(n,t+"-end"),e),start:o.parentNode.insertBefore(ai(n,t+"-start"),o)}},yi=function(n,t,i){l(n,n.get(t.prefix+"-end"),i);l(n,n.get(t.prefix+"-start"),i)},rf=function(n,t,i){return function(n,t){var e=n.data,r=e.substring(0,t),u=r.lastIndexOf(i.charAt(i.length-1)),f=r.lastIndexOf(i);return f!==-1?f+i.length:u!==-1?u+1:-1}},pi=function(n,i,r,f){var e=i.start,o=yu(n,f.container,f.offset,rf(n,r,e),r);return o.bind(function(f){var o,s;return f.offset>=e.length?(o=n.createRng(),o.setStart(f.container,f.offset-e.length),o.setEnd(f.container,f.offset),t.some(o)):(s=f.offset-e.length,st(f.container,s,r).map(function(t){var i=n.createRng();return i.setStart(t.container,t.offset),i.setEnd(f.container,f.offset),i}).filter(function(n){return n.toString()===e}).orThunk(function(){return pi(n,i,r,u(f.container,0))}))})},uf=function(n,i,r,u,f,e){if(e===void 0&&(e=!1),i.start.length===0&&!e){var o=n.createRng();return o.setStart(r,u),o.setEnd(r,u),t.some(o)}return ot(r,u,f).bind(function(r){var u=pi(n,i,f,r);return u.bind(function(n){return e&&(n.endContainer===r.container&&n.endOffset===r.offset||r.offset===0&&n.endContainer.textContent.length===n.endOffset)?t.none():t.some(n)})})},ff=function(n,i,r){var e=n.dom,o=e.getRoot(),f=r.pattern,s=r.position.container,h=r.position.offset;return st(s,h-r.pattern.end.length,i).bind(function(c){var l=ht(o,c.container,c.offset,s,h);if(ft(f))return t.some({matches:[{pattern:f,startRng:l,endRng:l}],position:c});var a=wi(n,r.remainingPatterns,c.container,c.offset,i),v=a.getOr({matches:[],position:c}),y=v.position,p=uf(e,f,y.container,y.offset,i,a.isNone());return p.map(function(n){var t=pu(o,n);return{matches:v.matches.concat([{pattern:f,startRng:t,endRng:l}]),position:u(n.startContainer,n.startOffset)}})})},wi=function(n,i,r,u,f){var e=n.dom;return ot(r,u,e.getRoot()).bind(function(o){var h=e.createRng(),v,s,c,l,a;for(h.setStart(f,0),h.setEnd(r,u),v=h.toString(),s=0;s<i.length;s++)if((c=i[s],tf(v,c.end))&&(l=i.slice(),l.splice(s,1),a=ff(n,f,{pattern:c,remainingPatterns:l,position:o}),a.isSome()))return a;return t.none()})},bi=function(n,t,i){n.selection.setRng(i);t.type==="inline-format"?e(t.format,function(t){n.formatter.apply(t)}):n.execCommand(t.cmd,!1,t.value)},ef=function(n,t,i,r){var u=it(n.dom,i);g(n.dom,u,r);bi(n,t,u)},sf=function(n,t,i,r,u){var f=n.dom,s=it(f,r),h=it(f,i),e,o;g(f,h,u);g(f,s,u);e={prefix:i.prefix,start:i.end,end:r.start};o=it(f,e);bi(n,t,o)},hf=function(n,t){var i=gu("mce_textpattern"),r=pt(t,function(t,r){var u=vi(n,i+("_end"+t.length),r.endRng);return t.concat([o(o({},r),{endMarker:u})])},[]);return pt(r,function(t,u){var f=r.length-t.length-1,e=ft(u.pattern)?u.endMarker:vi(n,i+("_start"+f),u.startRng);return t.concat([o(o({},u),{startMarker:e})])},[])},ki=function(n,t,i){var r=n.selection.getRng();return r.collapsed===!1?[]:et(n,r).bind(function(u){var f=r.startOffset-(i?1:0);return wi(n,t,r.startContainer,f,u)}).fold(function(){return[]},function(n){return n.matches})},di=function(n,t){if(t.length!==0){var i=n.dom,r=n.selection.getBookmark(),u=hf(i,t);e(u,function(t){var u=i.getParent(t.startMarker.start,i.isBlock),r=function(n){return n===u};ft(t.pattern)?ef(n,t.pattern,t.endMarker,r):sf(n,t.pattern,t.startMarker,t.endMarker,r);yi(i,t.endMarker,r);yi(i,t.startMarker,r)});n.selection.moveToBookmark(r)}},cf=function(n,t){if(!n.selection.isCollapsed())return!1;var i=ki(n,t.inlinePatterns,!1),r=ku(n,t.blockPatterns);return r.length>0||i.length>0?(n.undoManager.add(),n.undoManager.extra(function(){n.execCommand("mceInsertNewLine")},function(){n.insertContent(fi);di(n,i);du(n,r);var t=n.selection.getRng(),u=ot(t.startContainer,t.startOffset,n.dom.getRoot());n.execCommand("mceInsertNewLine");u.each(function(t){var i=t.container;i.data.charAt(t.offset-1)===fi&&(i.deleteData(t.offset-1,1),l(n.dom,i.parentNode,function(t){return t===n.dom.getRoot()}))})}),!0):!1},lf=function(n,t){var i=ki(n,t.inlinePatterns,!0);i.length>0&&n.undoManager.transact(function(){di(n,i)})},gi=function(n,t,i){for(var r=0;r<n.length;r++)if(i(n[r],t))return!0},af=function(n,t){return gi(n,t,function(n,t){return n===t.keyCode&&ui.modifierPressed(t)===!1})},vf=function(n,t){return gi(n,t,function(n,t){return n.charCodeAt(0)===t.charCode})},p={handleEnter:cf,handleInlineKey:lf,checkCharCode:vf,checkKeyCode:af},yf=function(n,t){var i=[",",".",";",":","!","?"],r=[32];n.on("keydown",function(i){i.keyCode!==13||ui.modifierPressed(i)||p.handleEnter(n,t.get())&&i.preventDefault()},!0);n.on("keyup",function(i){p.checkKeyCode(r,i)&&p.handleInlineKey(n,t.get())});n.on("keypress",function(r){p.checkCharCode(i,r)&&ou.setEditorTimeout(n,function(){p.handleInlineKey(n,t.get())})})},pf={setup:yf};wf()})(window);
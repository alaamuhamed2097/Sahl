/**
 * Blazor WebAssembly Initialization and Core Dependencies
 * Handles Blazor startup, jQuery, localization, and critical features
 */

(function() {
    'use strict';

    // Performance monitoring for LCP optimization
    window.performanceMetrics = {
      startTime: performance.now(),
    lcpCandidate: null,

        // Track LCP candidates
        observeLCP: function () {
       if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
         const entries = list.getEntries();
   const lastEntry = entries[entries.length - 1];
          this.lcpCandidate = lastEntry;
             });
       observer.observe({ entryTypes: ['largest-contentful-paint'] });
     }
        },

        // Progress tracking for better UX
        updateProgress: function (percentage) {
   const progressBar = document.getElementById('progress-bar');
 if (progressBar) {
        progressBar.style.width = percentage + '%';
            }
   }
    };

    // Start LCP observation immediately
    window.performanceMetrics.observeLCP();

// Simulate loading progress for better UX
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.random() * 10;
        if (progress > 90) progress = 90;
      window.performanceMetrics.updateProgress(progress);
    }, 100);

    // Clear interval when Blazor starts
    window.addEventListener('blazor-started', () => {
        clearInterval(progressInterval);
  window.performanceMetrics.updateProgress(100);
    });

  // Debug timeout handler to prevent hanging in mono_wasm_fire_debugger_agent_message
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        // Override console.assert to prevent debugger hangs
     const originalAssert = console.assert;
    let debuggerHangTimeout = null;

        console.assert = function (...args) {
            // Clear any existing timeout
   if (debuggerHangTimeout) {
       clearTimeout(debuggerHangTimeout);
    }

            // Set timeout to detect debugger hangs (5 seconds)
    debuggerHangTimeout = setTimeout(() => {
 console.warn('Debugger agent may be hanging. Consider refreshing the page or disabling debugger.');
            }, 5000);

            // Call original assert
 originalAssert.apply(console, args);

            // Clear timeout after successful assert
     setTimeout(() => {
   if (debuggerHangTimeout) {
                    clearTimeout(debuggerHangTimeout);
          debuggerHangTimeout = null;
          }
            }, 100);
        };
    }

    // jQuery dependency tracker
    window.jQueryReady = false;

    // Localization dependency tracker
    window.localizationReady = false;

    // Check if jQuery is loaded
    function checkjQueryLoaded() {
      return typeof $ !== 'undefined' && typeof jQuery !== 'undefined';
  }

    // Check if localization is loaded
    function checkLocalizationLoaded() {
     return typeof localization !== 'undefined' && typeof localization.getCurrentLanguage === 'function';
    }

    // Wait for jQuery to be available
    function waitForjQuery(callback) {
        if (checkjQueryLoaded()) {
    window.jQueryReady = true;
            callback();
        } else {
    setTimeout(() => waitForjQuery(callback), 50);
  }
    }

    // Wait for localization to be available
    function waitForLocalization(callback) {
        if (checkLocalizationLoaded()) {
 window.localizationReady = true;
            callback();
} else {
    setTimeout(() => waitForLocalization(callback), 50);
        }
    }

    // Wait for all dependencies
    function waitForDependencies(callback) {
        const checkAndProceed = () => {
  if (checkjQueryLoaded() && checkLocalizationLoaded()) {
        window.jQueryReady = true;
   window.localizationReady = true;
      callback();
            } else {
 setTimeout(checkAndProceed, 50);
            }
        };
        checkAndProceed();
    }

    // Export functions for global access
    window.checkjQueryLoaded = checkjQueryLoaded;
    window.checkLocalizationLoaded = checkLocalizationLoaded;
 window.waitForjQuery = waitForjQuery;
    window.waitForLocalization = waitForLocalization;
    window.waitForDependencies = waitForDependencies;

    // Blazor startup configuration
 window.startBlazor = function() {
      Blazor.start({
    loadBootResource: function (type, name, defaultUri, integrity) {
  // Optimize resource loading
      if (type === 'dotnetjs') {
     return defaultUri + '?v=' + Date.now();
     }
       return defaultUri;
            },
            // Add debug configuration
       circuit: {
                reconnectionOptions: {
      maxRetries: 3,
 retryIntervalMilliseconds: 2000
      }
            }
        }).then(() => {
// Blazor has started - hide loading screen
          document.body.classList.add('loaded');
      document.body.classList.remove('loading');

       // Dispatch custom event for other scripts
         window.dispatchEvent(new CustomEvent('blazor-started'));

            // Wait for all dependencies before initializing critical features
        waitForDependencies(() => {
       if (typeof initializeCriticalFeatures === 'function') {
          initializeCriticalFeatures();
                }
      });
      });
    };

})();
/**
 * Menu System and Navigation for Sahl Dashboard
 * Handles mobile menu, responsive navigation, and active states
 */

(function() {
    'use strict';

    // Enhanced menu toggle for Blazor WebAssembly
 function initializeCriticalFeatures() {
        // Ensure all dependencies are loaded before proceeding
 if (!window.checkjQueryLoaded()) {
            console.warn('jQuery not loaded yet, waiting...');
  window.waitForjQuery(initializeCriticalFeatures);
      return;
}

      if (!window.checkLocalizationLoaded()) {
 console.warn('Localization not loaded yet, waiting...');
      window.waitForLocalization(initializeCriticalFeatures);
     return;
        }

    // Enhanced menu toggle for Blazor WebAssembly
      $(document).off('click.blazor-enhanced').on('click.blazor-enhanced', '#mobile-collapse, #mobile-collapse1, .mobile-menu', function (e) {
   e.preventDefault();
   e.stopPropagation();

            var vw = window.innerWidth || document.documentElement.clientWidth;

       if (vw < 992) {
    var $navbar = $(".pcoded-navbar");
    var isOpen = $navbar.hasClass('mob-open');

      if (isOpen) {
           $navbar.removeClass('mob-open');
 $(this).removeClass('on');
     $(".mobile-menu").removeClass('on');
      $("#mobile-collapse, #mobile-collapse1").removeClass('on');
 } else {
        $navbar.addClass('mob-open');
     $(this).addClass('on');
         $(".mobile-menu").addClass('on');
     $("#mobile-collapse, #mobile-collapse1").addClass('on');
   }
         }
     });

   // Initialize responsive navbar
      var currentVw = window.innerWidth || document.documentElement.clientWidth;
  var $navbar = $(".pcoded-navbar");

     if (currentVw >= 992 && currentVw <= 1200) {
     $navbar.addClass('navbar-collapsed');
        } else if (currentVw >= 1200) {
 $navbar.removeClass('navbar-collapsed');
      }
    }

    // Initialize navigation helpers - with dependency checks
    window.initializePcodedMenu = function () {
 try {
            // Wait for all dependencies if not loaded
   if (!window.checkjQueryLoaded() || !window.checkLocalizationLoaded()) {
          console.warn('Dependencies not available for pcoded menu initialization, waiting...');
      window.waitForDependencies(() => {
    window.initializePcodedMenu();
     });
    return;
    }

   if (typeof $.fn.pcodedmenu === 'function' && $("#pcoded").length > 0) {
    $("#pcoded").pcodedmenu({
   MenuTrigger: 'click',
      SubMenuTrigger: 'click',
         });
         }
        } catch (error) {
  console.error('Error initializing pcoded menu:', error);
    }
    };

    window.clearAllActiveStates = function () {
      if (!window.checkjQueryLoaded()) {
     console.warn('jQuery not available for clearing active states');
  return;
        }
        try {
 $(".pcoded-navbar .pcoded-inner-navbar li").removeClass("active");
            $(".pcoded-navbar .pcoded-inner-navbar .pcoded-hasmenu").removeClass("active pcoded-trigger");
$(".pcoded-navbar .nav-link").blur();
        } catch (error) {
    console.error('Error clearing active states:', error);
    }
    };

    window.setActiveMenuItems = function () {
        if (!window.checkjQueryLoaded()) {
     console.warn('jQuery not available for setting active menu items');
     return;
        }
 try {
      var pageUrl = window.location.href.split(/[?#]/)[0];
         $(".pcoded-navbar .pcoded-inner-navbar a").each(function () {
            if (this.href == pageUrl && $(this).attr('href') != "") {
       $(this).parent('li').addClass("active");
   if (!$('.pcoded-navbar').hasClass('theme-horizontal')) {
           $(this).parent('li').parent().parent('.pcoded-hasmenu').addClass("active").addClass("pcoded-trigger");
  }
      }
          });
      } catch (error) {
 console.error('Error setting active menu items:', error);
        }
    };

    // Initialize Perfect Scrollbar when needed
    window.initializePerfectScrollbar = function (selector) {
     if (typeof PerfectScrollbar === 'undefined') return;
try {
          var element = document.querySelector('.' + selector);
 if (element) {
                new PerfectScrollbar('.' + selector, {
   wheelSpeed: 0.5,
    swipeEasing: 0,
     suppressScrollX: true,
   wheelPropagation: 1,
         minScrollbarLength: 40,
                });
 }
        } catch (error) {
      console.error('Error initializing perfect scrollbar:', error);
        }
  };

    // Navigation scrollbar initialization
    window.initializeNavScrollbar = function () {
        if ('requestIdleCallback' in window) {
    requestIdleCallback(() => {
    if (document.querySelector('.navbar-content') && typeof PerfectScrollbar !== 'undefined') {
      if (window.navScrollbar) {
              window.navScrollbar.destroy();
      }
      window.navScrollbar = new PerfectScrollbar('.navbar-content', {
         wheelSpeed: 0.5,
       swipeEasing: 0,
           suppressScrollX: true,
        });
  }
       });
        }
    };

    // Initialize navbar handler
 window.navbarHandler = {
     init: function () {
   var navbarCollapse = document.getElementById("navbarSupportedContent");
            if (!navbarCollapse) return;

 var navList = navbarCollapse.querySelector("ul.navbar-nav");
     if (!window.matchMedia("(max-width: 991.98px)").matches) {
            navList.style.display = "";
     return;
            }

      var isShown = navbarCollapse.classList.contains("show");
        if (navList) {
      navList.style.display = isShown ? "" : "none";
            }
 }
    };

    // Export the main initialization function
 window.initializeCriticalFeatures = initializeCriticalFeatures;

})();
/**
 * Theme Manager and Component Script Loader for Sahl Dashboard
 * Handles dynamic CSS loading and component-specific scripts
 */

(function() {
    'use strict';

    // Enhanced CSS Theme Loader for Blazor WebAssembly
    window.ThemeManager = {
        loadTheme: function (themeName) {
      const themeFiles = {
    'layout-3': 'assets/css/layouts/layout-3.min.css',
        'layout-4': 'assets/css/layouts/layout-4.min.css',
       'layout-5': 'assets/css/layouts/layout-5.min.css',
          'layout-9': 'assets/css/layouts/layout-9.min.css',
         'layout-12': 'assets/css/layouts/layout-12.min.css',
 'dark': 'assets/css/layouts/dark.min.css',
       'rtl': 'assets/css/layouts/rtl.min.css',
     'landing': 'assets/css/layouts/landing.min.css'
            };

            if (themeFiles[themeName]) {
     this.loadCSS(themeFiles[themeName], 'theme-' + themeName);
       }
        },

        loadPageStyle: function (pageName) {
    const pageFiles = {
    'pages': 'assets/css/pages/pages.min.css',
         'gallery': 'assets/css/pages/gallery.min.css',
                'team-overview': 'css/team-overview.min.css'
   };

         if (pageFiles[pageName]) {
  this.loadCSS(pageFiles[pageName], 'page-' + pageName);
         }
        },

     loadCSS: function (href, id) {
            if (id && document.getElementById(id)) {
                document.getElementById(id).remove();
            }

 const link = document.createElement('link');
     link.rel = 'stylesheet';
    link.href = href;
          if (id) link.id = id;

    // Use requestIdleCallback for non-critical CSS
            if ('requestIdleCallback' in window) {
     requestIdleCallback(() => {
        document.head.appendChild(link);
 });
        } else {
      setTimeout(() => {
            document.head.appendChild(link);
     }, 0);
      }
   },

        unloadTheme: function (themeName) {
          const themeElement = document.getElementById('theme-' + themeName);
            if (themeElement) {
        themeElement.remove();
       }
        }
    };

    // Enhanced Script Loader for Blazor Components
    window.ComponentScriptLoader = {
        loadedScripts: new Set(),

        loadComponentScript: function (scriptName) {
  if (this.loadedScripts.has(scriptName)) {
        return Promise.resolve();
            }

            const scriptFiles = {
          'charts': 'js/statistics-charts.min.js',
  'Vendor-charts': 'js/Vendor-statistics-charts.min.js',
         'text-editor': 'js/text-editor.min.js',
       'rich-text-editor': 'assets/js/rich-text-editor-helper.js',
         'data-tables': 'assets/js/pages/data-basic-custom.min.js',
           'data-source': 'assets/js/pages/data-source-custom.min.js',
     'data-plugin': 'assets/js/pages/data-plugin-custom.min.js',
    'statistics': 'assets/js/pages/statistic.min.js',
      'notifications': 'assets/js/pages/ac-notification.min.js',
      'widget-data': 'assets/js/pages/widget-data.min.js',
                'team-overview': 'scripts/team-overview.min.js',
         'grid-animation': 'assets/js/pages/grid-animation/main.min.js',
   'daterangepicker': 'assets/js/plugins/daterangepicker.min.js',
       'trumbowyg': 'assets/js/plugins/trumbowyg/trumbowyg.min.js',
          'error-page': 'assets/js/pages/error.min.js'
   };

     if (!scriptFiles[scriptName]) {
             return Promise.reject(new Error('Script not found: ' + scriptName));
         }

          return this.loadScript(scriptFiles[scriptName])
       .then(() => {
        this.loadedScripts.add(scriptName);
             console.log('Loaded component script:', scriptName);
          });
        },

   loadScript: function (src) {
  return new Promise((resolve, reject) => {
      if (document.querySelector(`script[src="${src}"]`)) {
         resolve();
               return;
  }

            const script = document.createElement('script');
                script.src = src;
       script.async = true;
        script.onload = resolve;
         script.onerror = reject;
                document.head.appendChild(script);
    });
        }
    };

})();
/**
 * Deferred Script Loader and Service Worker Registration
 * Handles non-critical resource loading after Blazor initialization
 */

(function() {
    'use strict';

    // Load non-critical resources after Blazor starts
 function loadDeferredResources() {
        window.addEventListener('blazor-started', function () {
      setTimeout(() => {
    const deferredScripts = [
       'assets/plugins/sweetalert/js/sweetalert.min.js',
       'assets/js/pages/ac-alert.min.js'
         ];

         deferredScripts.forEach((src, index) => {
  setTimeout(() => {
         const script = document.createElement('script');
            script.src = src;
  script.async = true;
  document.head.appendChild(script);
}, index * 50);
   });
     }, 500);
        });
 }

    // Service worker registration - Non-blocking
  function registerServiceWorker() {
     if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
   navigator.serviceWorker.register('service-worker.js').catch(function (error) {
             console.log('Service worker registration failed:', error);
    });
        });
   }
    }

    // Initialize all deferred features
    function initializeDeferredFeatures() {
 loadDeferredResources();
        registerServiceWorker();
    }

    // Auto-initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeDeferredFeatures);
    } else {
   initializeDeferredFeatures();
    }

})();